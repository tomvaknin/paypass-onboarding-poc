<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pay. — Merchant Onboarding</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,400&family=DM+Mono:wght@400;500&display=swap');
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#f4f4f7;--white:#fff;--navy:#0f1523;
  --brand:#5b50f0;--brand-mid:#7b73f5;--brand-light:#eeeeff;--brand-hover:#4840d4;
  --g50:#fafafa;--g100:#f0f0f3;--g150:#e6e6ec;--g200:#d8d8e4;--g300:#b8b8cc;
  --g400:#8080a0;--g500:#606078;--g600:#404058;--g800:#1e1e32;
  --green:#16a34a;--green-light:#dcfce7;--green-border:#86efac;
  --red:#dc2626;--red-light:#fef2f2;--red-border:#fca5a5;
  --amber:#d97706;--amber-light:#fef3c7;
  --sidebar-w:264px;--r:8px;--r-lg:12px;
  --sh:0 1px 3px rgba(0,0,0,.07),0 4px 14px rgba(0,0,0,.05);
  --sh-lg:0 12px 36px rgba(0,0,0,.13);
  --sh-focus:0 0 0 3px rgba(91,80,240,.15);
}
html,body{height:100%;font-family:'DM Sans',sans-serif;font-size:14px;color:var(--navy);background:var(--bg);line-height:1.5}

/* ── LAYOUT ── */
.shell{display:flex;min-height:100vh}
.sidebar{width:var(--sidebar-w);min-width:var(--sidebar-w);background:var(--white);border-right:1px solid var(--g150);display:flex;flex-direction:column;position:fixed;top:0;left:0;bottom:0;z-index:100}
.sb-head{padding:20px 16px 16px;border-bottom:1px solid var(--g100);display:flex;align-items:center;gap:10px}
.logo{width:36px;height:36px;background:var(--navy);border-radius:9px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:13px;letter-spacing:-.5px;flex-shrink:0}
.logo-name{font-weight:700;font-size:17px;letter-spacing:-.5px}
.sb-nav{padding:10px 10px;flex:1;overflow-y:auto}
.ni{display:flex;align-items:flex-start;gap:10px;padding:9px 10px;border-radius:var(--r);cursor:pointer;transition:background .15s;position:relative;margin-bottom:1px}
.ni:not(:last-child)::after{content:'';position:absolute;left:22px;bottom:-9px;width:1px;height:9px;background:var(--g150)}
.ni:hover:not(.active):not(.locked){background:var(--g100)}
.ni.active{background:var(--brand-light)}
.ni.done .ni-ic{background:var(--green-light)}
.ni.locked{opacity:.4;cursor:not-allowed}
.ni-ic{width:28px;height:28px;min-width:28px;border-radius:7px;background:var(--g100);display:flex;align-items:center;justify-content:center;margin-top:1px}
.ni.active .ni-ic{background:var(--brand)}
.ni.active .ni-ic svg{stroke:#fff!important}
.ni.done .ni-ic svg{stroke:var(--green)!important}
.ni-t{font-size:12.5px;font-weight:600;color:var(--g800);line-height:1.2}
.ni.active .ni-t{color:var(--brand)}
.ni-s{font-size:11px;color:var(--g400);margin-top:2px;line-height:1.3}
.sb-foot{padding:14px 16px;border-top:1px solid var(--g100)}
.prog-row{display:flex;align-items:center;gap:8px}
.prog-track{flex:1;height:3px;background:var(--g150);border-radius:99px;overflow:hidden}
.prog-fill{height:100%;background:var(--brand);border-radius:99px;transition:width .4s ease}
.prog-txt{font-size:10.5px;color:var(--g400);font-family:'DM Mono',monospace;white-space:nowrap}

/* ── MAIN ── */
.main{margin-left:var(--sidebar-w);flex:1;display:flex;flex-direction:column;align-items:center;padding:40px 24px 80px;min-height:100vh}
.sv{display:none;width:100%;max-width:640px;animation:fadeUp .25s ease both}
.sv.active{display:block}
@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

/* ── CARD ── */
.card{background:var(--white);border-radius:var(--r-lg);box-shadow:var(--sh);padding:30px 34px;margin-bottom:16px}
.card-head{padding-bottom:20px;margin-bottom:20px;border-bottom:1px solid var(--g100)}
.chip{display:inline-flex;align-items:center;gap:5px;font-size:10px;font-weight:600;letter-spacing:.07em;text-transform:uppercase;color:var(--brand);background:var(--brand-light);padding:3px 9px;border-radius:20px;margin-bottom:9px;font-family:'DM Mono',monospace}
.card-title{font-size:20px;font-weight:700;letter-spacing:-.3px;margin-bottom:4px}
.card-sub{font-size:13px;color:var(--g400);line-height:1.55}

/* ── SECTIONS ── */
.sect{margin-bottom:20px}
.sl{font-size:10px;font-weight:600;letter-spacing:.1em;text-transform:uppercase;color:var(--g400);font-family:'DM Mono',monospace;margin-bottom:11px;display:flex;align-items:center;gap:8px}
.sl::after{content:'';flex:1;height:1px;background:var(--g100)}

/* ── FIELDS ── */
.field{margin-bottom:11px}
.gr2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.gr3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
.field-inner{position:relative}

/* label */
.lbl{display:flex;align-items:center;gap:4px;font-size:12px;font-weight:500;color:var(--g600);margin-bottom:4px;line-height:1.3}
.lbl .opt{font-weight:400;color:var(--g300);font-size:11px}

/* tooltip trigger */
.tip{display:inline-flex;width:14px;height:14px;background:var(--g300);border-radius:50%;color:#fff;font-size:9px;font-weight:700;align-items:center;justify-content:center;cursor:help;position:relative;flex-shrink:0;font-style:normal;font-family:'DM Mono',monospace}
.tip::before,.tip::after{display:none!important}
.tip:hover::before,.tip:hover::after{opacity:1}

/* inputs */
.inp{width:100%;height:38px;padding:0 11px;border:1.5px solid var(--g200);border-radius:var(--r);font-family:'DM Sans',sans-serif;font-size:13px;color:var(--navy);background:var(--white);outline:none;transition:border-color .15s,box-shadow .15s;appearance:none}
.inp::placeholder{color:var(--g300)}
.inp:hover:not(:focus):not(.err):not(.ok){border-color:var(--g300)}
.inp:focus{border-color:var(--brand);box-shadow:var(--sh-focus)}
.inp.err{border-color:var(--red)!important;background:var(--red-light)}
.inp.ok{border-color:var(--green-border)}
textarea.inp{height:auto;padding:10px 11px;resize:vertical;min-height:84px;line-height:1.5}
.sel-w{position:relative}
.sel-w::after{content:'';position:absolute;right:11px;top:50%;transform:translateY(-50%);width:0;height:0;border-left:4px solid transparent;border-right:4px solid transparent;border-top:5px solid var(--g400);pointer-events:none}
.sel-w select.inp{padding-right:28px;cursor:pointer}
/* prefix/suffix */
.inp-pfx{position:relative}
.inp-pfx .pfx{position:absolute;left:10px;top:50%;transform:translateY(-50%);font-size:13px;color:var(--g400);pointer-events:none;z-index:1}
.inp-pfx .inp{padding-left:22px}
.inp-sfx{position:relative}
.inp-sfx .sfx{position:absolute;right:10px;top:50%;transform:translateY(-50%);font-size:12px;color:var(--g400);pointer-events:none}
.inp-sfx .inp{padding-right:28px}
/* icons inside input */
.inp-ic{position:relative}
.inp-ic .ok-ic,.inp-ic .err-ic{position:absolute;right:10px;top:50%;transform:translateY(-50%);display:none}
.inp-ic .ok-ic{color:var(--green)}
.inp-ic .err-ic{color:var(--red)}
.inp-ic .inp.ok ~ .ok-ic{display:flex}
.inp-ic .inp.err ~ .err-ic{display:flex}

/* error message */
.err-msg{font-size:11px;color:var(--red);margin-top:3px;display:none;align-items:center;gap:4px}
.err-msg.show{display:flex}
.hint{font-size:11px;color:var(--g400);margin-top:3px;line-height:1.4}

/* phone */
.ph-row{display:flex}
.ph-row .sel-w{flex:0 0 84px}
.ph-row .sel-w select.inp{border-radius:var(--r) 0 0 var(--r);border-right:none;background:var(--g50);font-size:12px;padding-left:8px}
.ph-row .inp:last-child{border-radius:0 var(--r) var(--r) 0;flex:1}

/* checkbox */
.chk-row{display:flex;align-items:center;gap:9px;padding:9px 11px;background:var(--g50);border:1.5px solid var(--g150);border-radius:var(--r);cursor:pointer;transition:border-color .15s,background .15s;font-size:12.5px;color:var(--g600);user-select:none;margin-bottom:10px}
.chk-row:hover{border-color:var(--brand);background:var(--brand-light)}
.chk-row input{width:14px;height:14px;accent-color:var(--brand);cursor:pointer;flex-shrink:0}

/* radio pills */
.rg{display:flex;gap:6px;flex-wrap:wrap}
.rp{display:inline-flex;align-items:center;gap:6px;padding:6px 14px;border:1.5px solid var(--g200);border-radius:99px;cursor:pointer;font-size:12.5px;color:var(--g600);transition:border-color .15s,background .15s,color .15s;user-select:none}
.rp:hover{border-color:var(--brand);color:var(--brand)}
.rp.on{border-color:var(--brand);background:var(--brand-light);color:var(--brand);font-weight:500}
.rp input{display:none}
.rg.err-grp .rp:first-child{border-color:var(--red)}

/* collapsible */
.col-hd{display:flex;align-items:center;justify-content:space-between;padding:9px 12px;background:var(--g50);border:1.5px solid var(--g150);border-radius:var(--r);cursor:pointer;transition:border-color .15s,background .15s;font-size:12.5px;font-weight:500;color:var(--g600)}
.col-hd:hover{border-color:var(--g300);background:var(--g100)}
.col-hd .arr{font-size:10px;color:var(--g400);transition:transform .2s}
.col-hd.open .arr{transform:rotate(180deg)}
.col-bd{display:none;padding:14px 0 2px}
.col-bd.open{display:block;animation:fd .2s ease}
@keyframes fd{from{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translateY(0)}}

/* cond block */
.cond{background:var(--g50);border-left:3px solid var(--brand);border-radius:0 var(--r) var(--r) 0;padding:14px;margin-top:10px;animation:fd .2s ease}

/* processing rows */
.proc-row{display:flex;margin-bottom:6px}
.proc-lbl{flex:1;padding:0 11px;height:36px;background:var(--g50);border:1.5px solid var(--g200);border-right:none;border-radius:var(--r) 0 0 var(--r);font-size:12px;color:var(--g600);display:flex;align-items:center}
.proc-inp-w{position:relative;width:76px}
.proc-inp-w input{width:100%;height:36px;border:1.5px solid var(--g200);border-radius:0 var(--r) var(--r) 0;text-align:right;padding:0 24px 0 8px;font-family:'DM Sans',sans-serif;font-size:13px;outline:none;transition:border-color .15s;background:var(--white)}
.proc-inp-w::after{content:'%';position:absolute;right:8px;top:50%;transform:translateY(-50%);font-size:12px;color:var(--g400);pointer-events:none}
.proc-inp-w input:focus{border-color:var(--brand);z-index:1;position:relative}
.proc-total{font-size:12px;margin-top:6px;padding:7px 11px;border-radius:var(--r);display:flex;align-items:center;gap:7px;font-family:'DM Mono',monospace}
.proc-total.ok{background:var(--green-light);color:var(--green)}
.proc-total.warn{background:var(--amber-light);color:var(--amber)}
.proc-total.over{background:var(--red-light);color:var(--red)}

/* add btn */
.add-btn{display:inline-flex;align-items:center;gap:6px;font-size:12.5px;font-weight:500;color:var(--brand);background:var(--brand-light);border:none;padding:7px 13px;border-radius:var(--r);cursor:pointer;transition:background .15s;font-family:'DM Sans',sans-serif}
.add-btn:hover{background:#e0dcff}

/* tags */
.tag{display:inline-flex;align-items:center;gap:5px;background:var(--brand-light);color:var(--brand);font-size:11.5px;padding:3px 9px;border-radius:99px;margin:3px 3px 3px 0;font-family:'DM Mono',monospace}
.tag button{background:none;border:none;cursor:pointer;color:var(--brand);font-size:13px;line-height:1;display:flex;padding:0}

/* person cards */
.pc{border:1.5px solid var(--g200);border-radius:var(--r-lg);padding:13px 15px;margin-bottom:9px;display:flex;align-items:center;justify-content:space-between;background:var(--white);transition:border-color .15s,box-shadow .15s}
.pc:hover{border-color:var(--brand);box-shadow:0 0 0 3px rgba(91,80,240,.06)}
.pc-name{font-size:13.5px;font-weight:600}
.pc-role{font-size:11.5px;color:var(--g400);margin-top:2px}
.pc-acts{display:flex;gap:6px}
.ic-btn{width:30px;height:30px;border:1.5px solid var(--g200);border-radius:var(--r);background:var(--white);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:border-color .15s,background .15s}
.ic-btn:hover{border-color:var(--g400);background:var(--g50)}
.ic-btn.del:hover{border-color:var(--red);background:var(--red-light)}

/* empty state */
.empty{text-align:center;padding:36px 20px;border:2px dashed var(--g200);border-radius:var(--r-lg)}
.empty .ei{font-size:28px;margin-bottom:9px;opacity:.35}
.empty p{font-size:13px;color:var(--g400);margin-bottom:14px;line-height:1.5}

/* info banner */
.banner{display:flex;gap:10px;align-items:flex-start;padding:11px 14px;border-radius:var(--r);font-size:12px;line-height:1.5;margin-bottom:16px}
.banner.info{background:var(--brand-light);border:1.5px solid #c5bfff;color:var(--brand)}
.banner.warn{background:var(--amber-light);border:1.5px solid #fcd34d;color:var(--amber)}
.banner.success{background:var(--green-light);border:1.5px solid var(--green-border);color:var(--green)}
.banner svg{flex-shrink:0;margin-top:1px}

/* footer nav */
.sf{display:flex;align-items:center;justify-content:space-between;padding-top:20px;margin-top:8px;border-top:1px solid var(--g100)}
.btn-p{height:40px;padding:0 22px;background:var(--brand);color:#fff;border:none;border-radius:var(--r);font-family:'DM Sans',sans-serif;font-size:13.5px;font-weight:600;cursor:pointer;transition:background .15s,box-shadow .15s,transform .1s;display:inline-flex;align-items:center;gap:7px}
.btn-p:hover{background:var(--brand-hover);box-shadow:0 4px 14px rgba(91,80,240,.3);transform:translateY(-1px)}
.btn-p:active{transform:translateY(0)}
.btn-p:disabled{background:var(--g300);cursor:not-allowed;transform:none;box-shadow:none}
.btn-s{height:40px;padding:0 18px;background:transparent;color:var(--g400);border:1.5px solid var(--g200);border-radius:var(--r);font-family:'DM Sans',sans-serif;font-size:13.5px;cursor:pointer;transition:border-color .15s,color .15s}
.btn-s:hover{border-color:var(--g400);color:var(--g600)}
.btn-g{background:none;border:none;font-family:'DM Sans',sans-serif;font-size:13px;color:var(--g400);cursor:pointer;padding:0;display:inline-flex;align-items:center;gap:5px}
.btn-g:hover{color:var(--g600)}

/* modal */
.mbg{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(3px);z-index:500;align-items:center;justify-content:center;padding:20px}
.mbg.open{display:flex}
.modal{background:var(--white);border-radius:16px;padding:26px;width:100%;max-width:520px;max-height:90vh;overflow-y:auto;box-shadow:var(--sh-lg);animation:mIn .2s ease}
@keyframes mIn{from{opacity:0;transform:scale(.97)}to{opacity:1;transform:scale(1)}}
.mh{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;padding-bottom:14px;border-top:none;border-bottom:1px solid var(--g100)}
.mh h2{font-size:17px;font-weight:700}
.close-btn{width:28px;height:28px;background:var(--g100);border:none;border-radius:7px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .15s}
.close-btn:hover{background:var(--g200)}

/* step counter dots */
.step-dots{display:flex;gap:5px;justify-content:center;margin-bottom:8px}
.dot{width:6px;height:6px;border-radius:50%;background:var(--g200);transition:background .2s}
.dot.on{background:var(--brand);width:18px;border-radius:3px}

/* success screen */
.success-wrap{text-align:center;padding:60px 20px}
.suc-icon{width:68px;height:68px;background:var(--green-light);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 20px}
.suc-icon svg{stroke:var(--green)}
.success-wrap h1{font-size:24px;font-weight:700;letter-spacing:-.4px;margin-bottom:8px}
.success-wrap p{font-size:13.5px;color:var(--g400);line-height:1.65;max-width:380px;margin:0 auto 22px}
.ref{display:inline-block;background:var(--brand-light);color:var(--brand);font-family:'DM Mono',monospace;font-size:13px;padding:6px 16px;border-radius:99px;margin-bottom:24px}

/* required star */
.req{color:var(--red);margin-left:2px;font-size:11px}

/* validation summary */
.val-sum{background:var(--red-light);border:1.5px solid var(--red-border);border-radius:var(--r);padding:12px 14px;margin-bottom:16px;display:none}
.val-sum.show{display:block}
.val-sum-title{font-size:12.5px;font-weight:600;color:var(--red);margin-bottom:6px;display:flex;align-items:center;gap:6px}
.val-sum ul{list-style:none;font-size:12px;color:var(--red)}
.val-sum ul li{padding:2px 0;padding-left:12px;position:relative}
.val-sum ul li::before{content:'•';position:absolute;left:0}

/* routing diagram hint */
.check-img{display:flex;align-items:center;gap:3px;padding:8px 11px;background:var(--g50);border:1.5px solid var(--g150);border-radius:var(--r);margin-top:6px;font-size:11px;color:var(--g500)}
.check-box{padding:3px 6px;border:1px solid var(--g300);border-radius:4px;font-family:'DM Mono',monospace;font-size:10px;color:var(--g600);white-space:nowrap}

/* progress fill color by step */
.prog-fill{background:linear-gradient(90deg,var(--brand),var(--brand-mid))}

/* scroll to top */
.scroll-top{display:none}

/* ═══════════════════════════════════════════
   MOBILE RESPONSIVE — inserted after base CSS
   ═══════════════════════════════════════════ */

/* ── Mobile top bar (hidden on desktop) ── */
.mob-bar{
  display:none;
  position:fixed;top:0;left:0;right:0;
  height:56px;
  background:var(--white);
  border-bottom:1px solid var(--g150);
  z-index:200;
  align-items:center;
  justify-content:space-between;
  padding:0 16px;
}
.mob-bar-logo{display:flex;align-items:center;gap:8px}
.mob-bar-logo .logo{width:30px;height:30px;font-size:11px;border-radius:7px}
.mob-bar-logo .logo-name{font-size:15px;font-weight:700;letter-spacing:-.4px}
.mob-progress{flex:1;margin:0 16px;display:flex;flex-direction:column;align-items:center;gap:3px}
.mob-progress .mob-prog-track{width:100%;height:3px;background:var(--g150);border-radius:99px;overflow:hidden}
.mob-progress .mob-prog-fill{height:100%;background:var(--brand);border-radius:99px;transition:width .4s ease}
.mob-progress .mob-prog-label{font-size:10.5px;color:var(--g400);font-family:'DM Mono',monospace}
.mob-menu-btn{
  width:34px;height:34px;
  background:var(--g100);border:none;border-radius:7px;
  cursor:pointer;display:flex;align-items:center;justify-content:center;
  flex-shrink:0;
}
.mob-menu-btn:active{background:var(--g200)}

/* ── Mobile nav drawer (hidden on desktop) ── */
.mob-drawer-bg{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,.4);
  z-index:300;
}
.mob-drawer-bg.open{display:block}
.mob-drawer{
  position:fixed;top:0;left:0;bottom:0;
  width:280px;
  background:var(--white);
  z-index:301;
  transform:translateX(-100%);
  transition:transform .25s ease;
  display:flex;flex-direction:column;
  overflow-y:auto;
}
.mob-drawer.open{transform:translateX(0)}
.mob-drawer-head{
  padding:18px 16px 14px;
  border-bottom:1px solid var(--g100);
  display:flex;align-items:center;justify-content:space-between;
}
.mob-drawer-head .logo-row{display:flex;align-items:center;gap:8px}
.mob-drawer-nav{padding:10px 10px;flex:1}
.mob-drawer-foot{padding:14px 16px;border-top:1px solid var(--g100)}

@media (max-width: 768px) {
  /* Show mobile bar, hide sidebar */
  .mob-bar{display:flex}
  .sidebar{display:none}

  /* Main content: no left margin, top padding for mobile bar */
  .main{
    margin-left:0;
    padding:72px 12px 100px;
  }

  /* Cards: tighter padding */
  .card{padding:20px 16px;border-radius:var(--r)}

  /* Card title smaller */
  .card-title{font-size:17px}
  .card-sub{font-size:12.5px}

  /* Collapse 2-col grids to 1 col on small screens */
  .gr2{grid-template-columns:1fr}
  .gr3{grid-template-columns:1fr 1fr}

  /* Step footer: stack on very small screens */
  .sf{flex-wrap:wrap;gap:10px}
  .sf .btn-p{flex:1;justify-content:center;min-width:0}
  .sf .btn-g{width:100%;justify-content:center;order:-1;padding:8px 0;color:var(--g500)}

  /* Buttons: taller touch targets */
  .btn-p{height:46px;font-size:14px;border-radius:var(--r)}
  .btn-s{height:46px;font-size:14px}

  /* Inputs: larger for touch */
  .inp{height:44px;font-size:15px;border-radius:var(--r)}
  textarea.inp{font-size:14px}
  .ph-row .sel-w{flex:0 0 82px}

  /* Radio pills: full-width on mobile */
  .rg{flex-direction:column;gap:7px}
  .rp{width:100%;padding:10px 14px;border-radius:var(--r);justify-content:flex-start}

  /* Checkbox rows */
  .chk-row{padding:11px 12px;font-size:13px}
  .chk-row input{width:16px;height:16px;flex-shrink:0}

  /* Processing rows: tighter label */
  .proc-lbl{font-size:11px;padding:0 8px}
  .proc-inp-w{width:68px}

  /* Banner text */
  .banner{font-size:12px}

  /* Section label */
  .sl{font-size:9.5px}

  /* Modal: full screen on mobile */
  .mbg{padding:0;align-items:flex-end}
  .modal{
    border-radius:16px 16px 0 0;
    max-height:92vh;
    padding:20px 18px;
  }

  /* Collapsible headers */
  .col-hd{font-size:12px;padding:10px 11px}

  /* Person cards */
  .pc{flex-wrap:wrap;gap:10px}
  .pc-acts{width:100%}
  .ic-btn{flex:1;height:36px;width:auto}

  /* Success screen */
  .success-wrap{padding:40px 16px}
  .success-wrap h1{font-size:20px}

  /* Cond block */
  .cond{padding:12px}

  /* Proc total bar wraps text properly */
  .proc-total{font-size:11px;flex-wrap:wrap}

  /* val summary */
  .val-sum{font-size:12px}

  /* Step dots */
  .step-dots{margin-bottom:6px}
}

@media (max-width: 400px) {
  .gr3{grid-template-columns:1fr}
  .card{padding:16px 13px}
  .card-title{font-size:16px}
  .main{padding:68px 10px 90px}
  .mob-bar{padding:0 12px}
}



/* test mode body banner */
.test-mode-banner{
  display:none;
  background:#78350f;
  color:#fef3c7;
  font-size:11.5px;font-family:'DM Mono',monospace;
  padding:5px 12px;
  text-align:center;
  letter-spacing:.03em;
  position:fixed;
  top:0;left:0;right:0;
  z-index:9001;
}
.test-mode-banner.on{display:block}

/* when test mode banner is visible, push mob-bar down */
body.test-mode .mob-bar{top:26px}
body.test-mode .main{padding-top:72px}
@media(max-width:768px){
  body.test-mode .main{padding-top:100px}
}

/* test mode: dim required star */
body.test-mode .req{opacity:.3}

/* test mode: highlight the form card with amber outline */
body.test-mode .card{
  outline:2px solid rgba(245,158,11,.2);
}

/* mobile test bar adjustments */
@media(max-width:768px){
}


/* ══════════════════════════════════════════
   PROFILE & TEAM COLLABORATION
   ══════════════════════════════════════════ */

/* Sidebar profile widget */
.sb-profile{
  padding:12px 14px;
  border-top:1px solid var(--g100);
  display:flex;align-items:center;gap:10px;
  cursor:pointer;
  transition:background .15s;
  position:relative;
}
.sb-profile:hover{background:var(--g50)}
.sb-profile:hover .sb-profile-arrow{opacity:1}
.avatar{
  width:32px;height:32px;border-radius:50%;
  background:linear-gradient(135deg,var(--brand),var(--brand-mid));
  display:flex;align-items:center;justify-content:center;
  color:#fff;font-size:12px;font-weight:700;
  flex-shrink:0;letter-spacing:-.3px;
}
.avatar.sm{width:26px;height:26px;font-size:10px}
.avatar.lg{width:40px;height:40px;font-size:15px}
.sb-profile-info{flex:1;min-width:0}
.sb-profile-name{font-size:12.5px;font-weight:600;color:var(--g800);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.sb-profile-email{font-size:10.5px;color:var(--g400);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.sb-profile-arrow{font-size:10px;color:var(--g400);opacity:0;transition:opacity .15s;flex-shrink:0}

/* Profile modal overlay */
.prof-bg{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,.45);backdrop-filter:blur(3px);
  z-index:600;align-items:center;justify-content:center;padding:20px;
}
.prof-bg.open{display:flex}

/* Profile panel */
.prof-panel{
  background:var(--white);border-radius:16px;
  width:100%;max-width:520px;
  box-shadow:0 20px 60px rgba(0,0,0,.18);
  animation:mIn .22s ease;
  overflow:hidden;
  max-height:90vh;
  display:flex;flex-direction:column;
}
.prof-head{
  padding:20px 22px 16px;
  border-bottom:1px solid var(--g100);
  display:flex;align-items:center;gap:14px;
}
.prof-head-info{flex:1}
.prof-head-info h2{font-size:17px;font-weight:700;letter-spacing:-.3px}
.prof-head-info p{font-size:12.5px;color:var(--g400);margin-top:2px}
.prof-body{flex:1;overflow-y:auto;padding:0}

/* Profile tabs */
.prof-tabs{
  display:flex;border-bottom:1px solid var(--g100);
  padding:0 22px;
}
.prof-tab{
  padding:11px 4px;margin-right:22px;
  font-size:13px;font-weight:500;color:var(--g400);
  cursor:pointer;border-bottom:2px solid transparent;
  transition:color .15s,border-color .15s;
  white-space:nowrap;
}
.prof-tab:hover{color:var(--g600)}
.prof-tab.on{color:var(--brand);border-bottom-color:var(--brand)}

/* Tab content */
.prof-tab-content{display:none;padding:20px 22px}
.prof-tab-content.on{display:block}

/* My details section */
.prof-detail-row{
  display:flex;align-items:center;gap:12px;
  padding:12px 0;
  border-bottom:1px solid var(--g100);
}
.prof-detail-row:last-child{border-bottom:none}
.prof-detail-label{font-size:12px;color:var(--g400);width:110px;flex-shrink:0}
.prof-detail-value{font-size:13px;font-weight:500;color:var(--g800);flex:1}
.prof-detail-edit{
  font-size:12px;color:var(--brand);cursor:pointer;
  background:none;border:none;font-family:'DM Sans',sans-serif;
  padding:0;transition:opacity .15s;
}
.prof-detail-edit:hover{opacity:.7}

/* Invite section */
.invite-form{
  background:var(--g50);border:1.5px solid var(--g150);
  border-radius:var(--r-lg);padding:16px;margin-bottom:18px;
}
.invite-form-title{
  font-size:12.5px;font-weight:600;color:var(--g800);
  margin-bottom:12px;display:flex;align-items:center;gap:7px;
}
.invite-row{display:flex;gap:8px;align-items:flex-start;flex-wrap:wrap}
.invite-row .inp{flex:1;min-width:180px}
.invite-row .sel-w{flex:0 0 150px}
.invite-row .sel-w select{height:38px}

/* Duration pills */
.dur-group{display:flex;gap:5px;flex-wrap:wrap;margin-top:8px}
.dur-pill{
  padding:5px 11px;border-radius:99px;
  border:1.5px solid var(--g200);
  font-size:11.5px;color:var(--g500);font-weight:500;
  cursor:pointer;transition:all .15s;user-select:none;
  font-family:'DM Mono',monospace;
}
.dur-pill:hover{border-color:var(--brand);color:var(--brand)}
.dur-pill.on{border-color:var(--brand);background:var(--brand-light);color:var(--brand)}

/* Team member list */
.team-list{display:flex;flex-direction:column;gap:8px}
.team-card{
  display:flex;align-items:center;gap:12px;
  padding:11px 13px;
  border:1.5px solid var(--g150);border-radius:var(--r-lg);
  background:var(--white);
  transition:border-color .15s;
}
.team-card:hover{border-color:var(--g300)}
.team-card-info{flex:1;min-width:0}
.team-card-name{font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.team-card-email{font-size:11.5px;color:var(--g400);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.team-card-meta{display:flex;align-items:center;gap:7px;margin-top:3px;flex-wrap:wrap}

/* Access badge */
.acc-badge{
  display:inline-flex;align-items:center;gap:4px;
  font-size:10.5px;font-weight:600;
  padding:2px 8px;border-radius:99px;
  font-family:'DM Mono',monospace;
  white-space:nowrap;
}
.acc-badge.active{background:var(--green-light);color:var(--green)}
.acc-badge.expired{background:var(--g100);color:var(--g400)}
.acc-badge.pending{background:var(--amber-light);color:var(--amber)}
.acc-badge.owner{background:var(--brand-light);color:var(--brand)}

/* expiry text */
.exp-txt{font-size:10.5px;color:var(--g400);font-family:'DM Mono',monospace}
.exp-txt.soon{color:var(--amber)}

/* revoke btn */
.revoke-btn{
  background:none;border:1.5px solid var(--g200);
  border-radius:6px;padding:4px 9px;
  font-size:11px;color:var(--g400);cursor:pointer;
  font-family:'DM Sans',sans-serif;
  transition:border-color .15s,color .15s,background .15s;
  white-space:nowrap;flex-shrink:0;
}
.revoke-btn:hover{border-color:var(--red);color:var(--red);background:var(--red-light)}

/* extend btn */
.extend-btn{
  background:none;border:1.5px solid var(--g200);
  border-radius:6px;padding:4px 9px;
  font-size:11px;color:var(--brand);cursor:pointer;
  font-family:'DM Sans',sans-serif;
  transition:border-color .15s,background .15s;
  white-space:nowrap;flex-shrink:0;
}
.extend-btn:hover{border-color:var(--brand);background:var(--brand-light)}

/* empty team */
.team-empty{
  text-align:center;padding:30px 16px;
  border:2px dashed var(--g200);border-radius:var(--r-lg);
  color:var(--g400);font-size:13px;line-height:1.6;
}
.team-empty .tei{font-size:26px;margin-bottom:8px;opacity:.3}

/* invite success toast */
.toast{
  position:fixed;bottom:72px;left:50%;transform:translateX(-50%) translateY(20px);
  background:var(--g800);color:#fff;
  font-size:12.5px;padding:10px 18px;border-radius:99px;
  box-shadow:var(--sh-lg);z-index:10000;
  opacity:0;transition:opacity .2s,transform .2s;
  pointer-events:none;white-space:nowrap;
  display:flex;align-items:center;gap:8px;
}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* resend link */
.resend-btn{
  background:none;border:none;color:var(--brand);
  font-size:11px;cursor:pointer;font-family:'DM Sans',sans-serif;
  padding:0;text-decoration:underline;
}

/* profile footer */
.prof-footer{
  padding:14px 22px;
  border-top:1px solid var(--g100);
  display:flex;justify-content:flex-end;gap:8px;
}

/* online indicator */
.online-dot{
  width:8px;height:8px;border-radius:50%;
  background:var(--green);
  border:1.5px solid var(--white);
  position:absolute;bottom:-1px;right:-1px;
}
.avatar-wrap{position:relative;flex-shrink:0}

/* mobile adjustments */
@media(max-width:768px){
  .prof-panel{max-width:100%;border-radius:16px 16px 0 0;margin-top:auto}
  .prof-bg{align-items:flex-end;padding:0}
  .prof-tab{font-size:12.5px;margin-right:16px}
  .invite-row{flex-direction:column}
  .invite-row .sel-w{flex:0 0 auto;width:100%}
  .team-card-meta{gap:5px}
}


/* ── LAST UPDATED ── */
.lu-bar{
  display:flex;align-items:center;justify-content:space-between;
  margin-top:10px;
  padding:8px 12px;
  background:var(--g50);
  border:1.5px solid var(--g150);
  border-radius:var(--r);
  font-size:11.5px;
  color:var(--g400);
  gap:10px;
  flex-wrap:wrap;
}
.lu-bar-left{display:flex;align-items:center;gap:7px}
.lu-icon{color:var(--g300);flex-shrink:0}
.lu-text{font-family:'DM Mono',monospace;font-size:11px}
.lu-text strong{color:var(--g600);font-weight:600}
.lu-autosave{
  display:inline-flex;align-items:center;gap:5px;
  font-size:10.5px;font-family:'DM Mono',monospace;
  color:var(--green);
}
.lu-autosave-dot{
  width:6px;height:6px;border-radius:50%;
  background:var(--green);
  animation:autopulse 2.5s ease-in-out infinite;
}
@keyframes autopulse{0%,100%{opacity:1}50%{opacity:.3}}
.lu-saving{color:var(--amber)}
.lu-saving .lu-autosave-dot{background:var(--amber)}

/* sidebar last updated */
.sb-lastupdate{
  padding:6px 14px 10px;
  font-size:10.5px;color:var(--g400);
  font-family:'DM Mono',monospace;
  display:flex;align-items:center;gap:6px;
  border-bottom:1px solid var(--g100);
}
.sb-lastupdate svg{flex-shrink:0}

/* step header meta row */
.card-head-meta{
  display:flex;align-items:center;justify-content:space-between;
  margin-bottom:6px;
  flex-wrap:wrap;gap:6px;
}
.step-lu{
  font-size:10.5px;color:var(--g400);
  font-family:'DM Mono',monospace;
  display:flex;align-items:center;gap:5px;
}
.step-lu.has-update{color:var(--green)}
.step-lu.has-update svg{stroke:var(--green)}

/* history tooltip on lu bar */
.lu-history-btn{
  background:none;border:none;
  font-size:10.5px;color:var(--brand);
  cursor:pointer;font-family:'DM Mono',monospace;
  padding:0;text-decoration:underline;white-space:nowrap;
}
.lu-history-btn:hover{opacity:.7}

/* activity log panel */
.activity-panel{
  position:fixed;top:0;right:0;bottom:0;width:300px;
  background:var(--white);border-left:1px solid var(--g150);
  z-index:400;transform:translateX(100%);
  transition:transform .25s ease;
  display:flex;flex-direction:column;
  box-shadow:-8px 0 24px rgba(0,0,0,.08);
}
.activity-panel.open{transform:translateX(0)}
.act-head{
  padding:18px 18px 14px;
  border-bottom:1px solid var(--g100);
  display:flex;align-items:center;justify-content:space-between;
}
.act-head h3{font-size:15px;font-weight:700}
.act-body{flex:1;overflow-y:auto;padding:14px 18px}
.act-entry{
  display:flex;align-items:flex-start;gap:10px;
  padding:10px 0;
  border-bottom:1px solid var(--g100);
}
.act-entry:last-child{border-bottom:none}
.act-dot{
  width:8px;height:8px;border-radius:50%;
  background:var(--g300);flex-shrink:0;margin-top:5px;
}
.act-dot.save{background:var(--green)}
.act-dot.step{background:var(--brand)}
.act-dot.invite{background:var(--amber)}
.act-info .act-what{font-size:12.5px;font-weight:500;color:var(--g800)}
.act-info .act-when{font-size:11px;color:var(--g400);font-family:'DM Mono',monospace;margin-top:2px}
.act-info .act-who{font-size:11px;color:var(--g500);margin-top:1px}
.act-empty{text-align:center;padding:40px 10px;color:var(--g400);font-size:13px}

@media(max-width:768px){
  .activity-panel{width:100%}
  .lu-bar{font-size:11px}
}


/* ── TEST MODE INLINE TOGGLE (sidebar) ── */
.test-mode-row{
  display:flex;align-items:center;justify-content:space-between;
  padding:9px 14px;
  border-top:1px solid var(--g100);
  cursor:pointer;
  transition:background .15s;
  user-select:none;
}
.test-mode-row:hover{background:var(--g50)}
.test-mode-row-left{display:flex;align-items:center;gap:7px;font-size:12px;color:var(--g500);font-weight:500}
.test-mode-row svg{flex-shrink:0;color:var(--g400);transition:color .15s}
.test-mode-row.on .test-mode-row-left{color:#d97706}
.test-mode-row.on svg{color:#d97706}

/* compact inline toggle */
.sw-inline{
  position:relative;width:34px;height:20px;flex-shrink:0;
}
.sw-inline input{opacity:0;width:0;height:0;position:absolute}
.sw-track{
  position:absolute;inset:0;background:var(--g200);
  border-radius:99px;transition:background .2s;
}
.sw-thumb{
  position:absolute;top:2px;left:2px;
  width:16px;height:16px;border-radius:50%;
  background:#fff;box-shadow:0 1px 3px rgba(0,0,0,.25);
  transition:transform .2s;
}
.sw-inline input:checked ~ .sw-track{background:#f59e0b}
.sw-inline input:checked ~ .sw-track .sw-thumb{transform:translateX(14px)}

</style>
</head>
<body>

<!-- ══ MOBILE TOP BAR ══ -->
<div class="mob-bar" id="mob-bar">
  <div class="mob-bar-logo">
    <div class="logo">Pay.</div>
    <span class="logo-name">Pay.</span>
  </div>
  <div class="mob-progress">
    <div class="mob-prog-track"><div class="mob-prog-fill" id="mob-pf" style="width:10%"></div></div>
    <div class="mob-prog-label" id="mob-pt">Step 1 of 5</div>
  </div>
  <button class="mob-menu-btn" onclick="openMobDrawer()" aria-label="Open navigation">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
  </button>
</div>

<!-- ══ MOBILE DRAWER ══ -->
<div class="mob-drawer-bg" id="mob-drawer-bg" onclick="closeMobDrawer()"></div>
<div class="mob-drawer" id="mob-drawer">
  <div class="mob-drawer-head">
    <div class="logo-row">
      <div class="logo">Pay.</div>
      <span class="logo-name">Pay.</span>
    </div>
    <button class="close-btn" onclick="closeMobDrawer()">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
    </button>
  </div>
  <div class="mob-drawer-nav" id="mob-drawer-nav">
    <!-- populated by JS, same as sidebar -->
  </div>
  <div class="mob-drawer-foot">
    <div class="prog-row">
      <div class="prog-track"><div class="prog-fill" id="mob-pf2" style="width:10%"></div></div>
      <div class="prog-txt" id="mob-pt2">1 / 5</div>
    </div>
  </div>
</div>

<div class="shell">

<!-- ══ SIDEBAR ══ -->
<aside class="sidebar">
  <div class="sb-head">
    <div class="logo">Pay.</div>
    <span class="logo-name">Pay.</span>
  </div>
  <div class="sb-lastupdate" id="sb-lu">
    <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
    <span id="sb-lu-text">Not yet saved</span>
  </div>
  <nav class="sb-nav" id="sb-nav">
    <!-- steps injected by JS -->
  </nav>
  <div class="sb-foot">
    <div class="prog-row" style="margin-bottom:10px">
      <div class="prog-track"><div class="prog-fill" id="pf" style="width:10%"></div></div>
      <div class="prog-txt" id="pt">1 / 5</div>
    </div>
  </div>
  <!-- Test mode toggle -->
  <div class="test-mode-row" id="test-mode-row" onclick="document.getElementById('test-mode-chk').click()">
    <div class="test-mode-row-left">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18"/></svg>
      Test mode
    </div>
    <label class="sw-inline" onclick="event.stopPropagation()">
      <input type="checkbox" id="test-mode-chk" onchange="toggleTestMode()">
      <div class="sw-track"><div class="sw-thumb"></div></div>
    </label>
  </div>
  <!-- Profile widget -->
  <div class="sb-profile" onclick="openProfile()" title="My profile & team access">
    <div class="avatar-wrap">
      <div class="avatar" id="sb-avatar">JD</div>
      <div class="online-dot"></div>
    </div>
    <div class="sb-profile-info">
      <div class="sb-profile-name" id="sb-profile-name">John Doe</div>
      <div class="sb-profile-email" id="sb-profile-email"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="711b1e191f3110121c14121e03015f121e1c">[email&#160;protected]</a></div>
    </div>
    <span class="sb-profile-arrow">⚙</span>
  </div>
</aside>

<!-- ══ MAIN ══ -->
<main class="main" id="main">

<!-- ╔══════════════════════════════════════════╗
     ║  STEP 0 — GENERAL INFORMATION           ║
     ╚══════════════════════════════════════════╝ -->
<div class="sv active" id="sv-0">
<div class="card">
  <div class="card-head">
    <div class="step-dots" id="dots-0"></div>
    <div class="chip">Step 1 of 5</div>
    <h1 class="card-title">General information</h1>
    <p class="card-sub">Enter your business's legal details to begin the verification process.</p>

    <div class="lu-bar" id="lu-0">
      <div class="lu-bar-left">
        <svg class="lu-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        <span class="lu-text" id="lu-0-txt">Not yet saved</span>
      </div>
      <div style="display:flex;align-items:center;gap:10px">
        <span class="lu-autosave" id="lu-0-status" style="display:none">
          <span class="lu-autosave-dot"></span>Saved
        </span>
        <button class="lu-history-btn" onclick="openActivityPanel()">View history</button>
      </div>
    </div>
  </div>

  <div class="val-sum" id="vs-0"><div class="val-sum-title"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>Please fix the following errors</div><ul id="vl-0"></ul></div>

  <!-- Business Identity -->
  <div class="sect">
    <div class="sl">Business identity</div>

    <div class="field">
      <label class="lbl" for="biz-legal-name">Business legal name<span class="req">*</span>
        <i class="tip" data-tip="Enter the full legal name of your business exactly as it appears on your tax documents and government filings.">i</i>
      </label>
      <div class="inp-ic">
        <input class="inp" id="biz-legal-name" type="text" placeholder="e.g. Acme Corporation Inc." autocomplete="organization">
        <svg class="ok-ic" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
        <svg class="err-ic" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
      </div>
      <div class="err-msg" id="e-biz-legal-name"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><span>Business legal name is required</span></div>
    </div>

    <div class="gr2">
      <div class="field">
        <label class="lbl" for="doi">Date of incorporation<span class="req">*</span>
          <i class="tip" data-tip="The date your business was officially registered with the state. Found on your Articles of Incorporation or LLC operating agreement.">i</i>
        </label>
        <div class="inp-ic">
          <input class="inp" id="doi" type="text" placeholder="MM/DD/YYYY" onfocus="this.type='date'" onblur="if(!this.value)this.type='text'">
          <svg class="ok-ic" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
          <svg class="err-ic" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
        </div>
        <div class="err-msg" id="e-doi"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><span>Valid date required (must be in the past)</span></div>
      </div>
      <div class="field">
        <label class="lbl" for="ownership">Type of ownership<span class="req">*</span>
          <i class="tip" data-tip="Your legal business structure affects tax forms, liability, and required documentation. Select the type that matches your state registration.">i</i>
        </label>
        <div class="sel-w">
          <select class="inp" id="ownership" onchange="onOwnership()">
            <option value="">Select ownership type…</option>
            <option value="sole_prop">Sole Proprietorship</option>
            <option value="llc">LLC</option>
            <option value="corp">Corporation (C-Corp / S-Corp)</option>
            <option value="partnership">Partnership</option>
            <option value="nonprofit">Non-Profit Organization</option>
          </select>
        </div>
        <div class="err-msg" id="e-ownership"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><span>Please select an ownership type</span></div>
      </div>
    </div>

    <!-- Tax block (conditional on ownership) -->
    <div id="tax-block" style="display:none">
      <div class="cond">
        <div class="field">
          <label class="lbl" for="taxpayer-name">Taxpayer name<span class="req">*</span>
            <i class="tip" data-tip="For sole proprietors, this is typically your full legal name. For LLCs and corporations, this is usually the business legal name unless you have a different tax registration.">i</i>
          </label>
          <input class="inp" id="taxpayer-name" type="text" placeholder="As it appears on your tax return">
          <div class="err-msg" id="e-taxpayer-name"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><span>Taxpayer name is required</span></div>
        </div>
        <div class="gr2">
          <div class="field">
            <label class="lbl" for="tax-type">Tax ID type<span class="req">*</span>
              <i class="tip" data-tip="EIN (Employer Identification Number) is used by most businesses. SSN is used by sole proprietors without employees. Your choice must match what is on file with the IRS.">i</i>
            </label>
            <div class="sel-w">
              <select class="inp" id="tax-type" onchange="onTaxType()">
                <option value="EIN">EIN — Employer Identification Number</option>
                <option value="SSN">SSN — Social Security Number</option>
                <option value="ITIN">ITIN — Individual Taxpayer ID</option>
              </select>
            </div>
          </div>
          <div class="field">
            <label class="lbl" id="tax-id-lbl" for="tax-id">EIN number<span class="req">*</span>
              <i class="tip" id="tax-id-tip" data-tip="9-digit number assigned by the IRS. Format: XX-XXXXXXX. Found on CP-575 notice or prior year tax returns.">i</i>
            </label>
            <div class="inp-ic">
              <input class="inp" id="tax-id" type="text" placeholder="XX-XXXXXXX" maxlength="11">
              <svg class="ok-ic" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
              <svg class="err-ic" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
            </div>
            <div class="err-msg" id="e-tax-id"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><span id="e-tax-id-msg">Invalid EIN format (XX-XXXXXXX)</span></div>
          </div>
        </div>
        <div id="nonprofit-ext" style="display:none">
          <div class="field">
            <label class="lbl">501(c) Tax-exempt status?<span class="req">*</span>
              <i class="tip" data-tip="501(c)(3) organizations are federally tax-exempt nonprofits. If approved by the IRS, select Yes and be prepared to provide your determination letter.">i</i>
            </label>
            <div class="rg" id="rg-tax-exempt">
              <label class="rp" onclick="pickR(this,'tax_exempt')"><input type="radio" name="tax_exempt" value="no">No</label>
              <label class="rp" onclick="pickR(this,'tax_exempt')"><input type="radio" name="tax_exempt" value="yes">Yes — 501(c)(3) approved</label>
            </div>
          </div>
          <div class="field">
            <label class="lbl">Exempt payee?
              <i class="tip" data-tip="Exempt payees (IRS codes 1–13) are exempt from backup withholding. Most businesses are NOT exempt payees. Only select Yes if you are certain this applies to your organization.">i</i>
            </label>
            <div class="rg">
              <label class="rp" onclick="pickR(this,'exempt_payee')"><input type="radio" name="exempt_payee" value="no">No</label>
              <label class="rp" onclick="pickR(this,'exempt_payee')"><input type="radio" name="exempt_payee" value="yes">Yes</label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Registered Address -->
  <div class="sect">
    <div class="sl">Registered address</div>
    <div class="field">
      <label class="lbl" for="addr1">Street address<span class="req">*</span>
        <i class="tip" data-tip="Your principal place of business as registered with your state. P.O. boxes are not accepted for this field.">i</i>
      </label>
      <input class="inp" id="addr1" type="text" placeholder="123 Main Street" autocomplete="street-address">
      <div class="err-msg" id="e-addr1"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><span>Street address is required</span></div>
    </div>
    <div class="field">
      <input class="inp" id="addr2" type="text" placeholder="Suite, floor, unit (optional)" autocomplete="address-line2">
    </div>
    <div class="gr3">
      <div class="field">
        <label class="lbl" for="city">City<span class="req">*</span></label>
        <input class="inp" id="city" type="text" placeholder="New York" autocomplete="address-level2">
        <div class="err-msg" id="e-city"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>City is required</span></div>
      </div>
      <div class="field">
        <label class="lbl" for="state">State<span class="req">*</span></label>
        <div class="sel-w">
          <select class="inp" id="state" autocomplete="address-level1">
            <option value="">State…</option>
            <option>AL</option><option>AK</option><option>AZ</option><option>AR</option><option>CA</option><option>CO</option><option>CT</option><option>DE</option><option>FL</option><option>GA</option><option>HI</option><option>ID</option><option>IL</option><option>IN</option><option>IA</option><option>KS</option><option>KY</option><option>LA</option><option>ME</option><option>MD</option><option>MA</option><option>MI</option><option>MN</option><option>MS</option><option>MO</option><option>MT</option><option>NE</option><option>NV</option><option>NH</option><option>NJ</option><option>NM</option><option>NY</option><option>NC</option><option>ND</option><option>OH</option><option>OK</option><option>OR</option><option>PA</option><option>RI</option><option>SC</option><option>SD</option><option>TN</option><option>TX</option><option>UT</option><option>VT</option><option>VA</option><option>WA</option><option>WV</option><option>WI</option><option>WY</option><option>DC</option>
          </select>
        </div>
        <div class="err-msg" id="e-state"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>State required</span></div>
      </div>
      <div class="field">
        <label class="lbl" for="zip">ZIP code<span class="req">*</span>
          <i class="tip" data-tip="5-digit US ZIP code. Used for address verification and tax jurisdiction.">i</i>
        </label>
        <input class="inp" id="zip" type="text" placeholder="10001" maxlength="10" autocomplete="postal-code">
        <div class="err-msg" id="e-zip"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Valid ZIP code required (5 digits)</span></div>
      </div>
    </div>
  </div>

  <!-- DBA collapsible -->
  <div class="sect">
    <div class="col-hd" id="dba-hd" onclick="toggleCol('dba-bd','dba-hd')">
      <span style="display:flex;align-items:center;gap:8px">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 3H8L2 7"/></svg>
        Operating under a DBA (Doing Business As) name?
        <i class="tip" data-tip="A DBA (trade name / fictitious name) is the name you use with customers that differs from your legal business name. Required to be registered in most states." style="pointer-events:auto">i</i>
      </span>
      <span class="arr">▼</span>
    </div>
    <div class="col-bd" id="dba-bd">
      <div class="field">
        <label class="lbl" for="dba-name">DBA name<span class="req">*</span></label>
        <input class="inp" id="dba-name" type="text" placeholder="Your public-facing brand name">
        <div class="err-msg" id="e-dba-name"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>DBA name is required when this section is open</span></div>
      </div>
      <label class="chk-row" id="dba-same-row">
        <input type="checkbox" id="dba-same" checked onchange="toggleDbaAddr()">
        DBA address same as registered address
      </label>
      <div id="dba-addr-fields" style="display:none">
        <div class="field"><input class="inp" id="dba-addr1" type="text" placeholder="DBA Address line 1"><div class="err-msg" id="e-dba-addr1"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Address is required</span></div></div>
        <div class="field"><input class="inp" type="text" placeholder="Address line 2 (optional)"></div>
        <div class="gr3">
          <div class="field"><label class="lbl">City<span class="req">*</span></label><input class="inp" id="dba-city" type="text" placeholder="City"><div class="err-msg" id="e-dba-city"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>City required</span></div></div>
          <div class="field"><label class="lbl">State<span class="req">*</span></label><div class="sel-w"><select class="inp" id="dba-state"><option value="">State…</option><option>AL</option><option>AK</option><option>AZ</option><option>AR</option><option>CA</option><option>CO</option><option>CT</option><option>DE</option><option>FL</option><option>GA</option><option>HI</option><option>ID</option><option>IL</option><option>IN</option><option>IA</option><option>KS</option><option>KY</option><option>LA</option><option>ME</option><option>MD</option><option>MA</option><option>MI</option><option>MN</option><option>MS</option><option>MO</option><option>MT</option><option>NE</option><option>NV</option><option>NH</option><option>NJ</option><option>NM</option><option>NY</option><option>NC</option><option>ND</option><option>OH</option><option>OK</option><option>OR</option><option>PA</option><option>RI</option><option>SC</option><option>SD</option><option>TN</option><option>TX</option><option>UT</option><option>VT</option><option>VA</option><option>WA</option><option>WV</option><option>WI</option><option>WY</option><option>DC</option></select></div></div>
          <div class="field"><label class="lbl">ZIP<span class="req">*</span></label><input class="inp" id="dba-zip" type="text" placeholder="ZIP" maxlength="10"><div class="err-msg" id="e-dba-zip"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Valid ZIP required</span></div></div>
        </div>
      </div>
      <div class="field">
        <label class="lbl">DBA phone <span class="opt">(optional)</span></label>
        <div class="ph-row"><div class="sel-w"><select class="inp"><option>🇺🇸 +1</option></select></div><input class="inp" type="tel" placeholder="(555) 000-0000"></div>
      </div>
    </div>
  </div>

  <!-- Contact -->
  <div class="sect">
    <div class="sl">Contact & online presence</div>
    <div class="gr2">
      <div class="field">
        <label class="lbl" for="biz-phone">Business phone <span class="opt">(optional)</span>
          <i class="tip" data-tip="Main business contact number. Used for account verification and support communication.">i</i>
        </label>
        <div class="ph-row"><div class="sel-w"><select class="inp"><option>🇺🇸 +1</option></select></div><input class="inp" id="biz-phone" type="tel" placeholder="(555) 000-0000"></div>
        <div class="err-msg" id="e-biz-phone"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Invalid phone number format</span></div>
      </div>
      <div class="field">
        <label class="lbl" for="cs-phone">Customer service number <span class="opt">(optional)</span>
          <i class="tip" data-tip="This number may appear on customer receipts and credit card statements. Providing a live support line reduces chargebacks.">i</i>
        </label>
        <div class="ph-row"><div class="sel-w"><select class="inp"><option>🇺🇸 +1</option></select></div><input class="inp" id="cs-phone" type="tel" placeholder="(555) 000-0000"></div>
        <div class="err-msg" id="e-cs-phone"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Invalid phone number format</span></div>
      </div>
    </div>
    <div class="field">
      <label class="lbl">Website(s) / URL(s) <span class="opt">(optional)</span>
        <i class="tip" data-tip="Provide all URLs where you accept payments or advertise your products. Card networks require this for compliance review.">i</i>
      </label>
      <div id="url-tags"></div>
      <button class="add-btn" id="add-url-btn" onclick="showUrlInput()">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Add website
      </button>
      <div style="display:none;margin-top:8px" id="url-input-row">
        <div style="display:flex;gap:7px">
          <input class="inp" id="url-input" type="url" placeholder="https://yoursite.com" style="flex:1">
          <button class="btn-p" style="height:38px;padding:0 14px;font-size:12.5px" onclick="confirmUrl()">Add</button>
          <button class="btn-s" style="height:38px;padding:0 12px" onclick="cancelUrl()">Cancel</button>
        </div>
        <div class="err-msg" id="e-url" style="margin-top:4px"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Enter a valid URL starting with https://</span></div>
      </div>
    </div>
  </div>

  <!-- Compliance collapsible -->
  <div class="sect" style="margin-bottom:0">
    <div class="col-hd" id="comp-hd" onclick="toggleCol('comp-bd','comp-hd')">
      <span style="display:flex;align-items:center;gap:8px">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
        RS / Compliance notices address
        <i class="tip" data-tip="Address where regulatory and compliance correspondence will be sent. Defaults to your business registered address." style="pointer-events:auto">i</i>
      </span>
      <span class="arr">▼</span>
    </div>
    <div class="col-bd" id="comp-bd">
      <label class="chk-row"><input type="checkbox" checked>Same as business registered address</label>
    </div>
  </div>

  <div class="sf">
    <button class="btn-g"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v14a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/></svg>Save draft</button>
    <button class="btn-p" onclick="validateAndNext(0)">Continue to Business activity <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></button>
  </div>
</div>
</div>


<!-- ╔══════════════════════════════════════════╗
     ║  STEP 1 — BUSINESS ACTIVITY             ║
     ╚══════════════════════════════════════════╝ -->
<div class="sv" id="sv-1">
<div class="card">
  <div class="card-head">
    <div class="step-dots" id="dots-1"></div>
    <div class="chip">Step 2 of 5</div>
    <h1 class="card-title">Business activity</h1>
    <p class="card-sub">Help us understand how your business operates and processes payments.</p>
    <div class="lu-bar" id="lu-1">
      <div class="lu-bar-left">
        <svg class="lu-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        <span class="lu-text" id="lu-1-txt">Not yet saved</span>
      </div>
      <div style="display:flex;align-items:center;gap:10px">
        <span class="lu-autosave" id="lu-1-status" style="display:none">
          <span class="lu-autosave-dot"></span>Saved
        </span>
        <button class="lu-history-btn" onclick="openActivityPanel()">View history</button>
      </div>
    </div>
  </div>
  <div class="val-sum" id="vs-1"><div class="val-sum-title"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>Please fix the following errors</div><ul id="vl-1"></ul></div>

  <div class="sect">
    <div class="sl">Business classification</div>
    <div class="gr2">
      <div class="field">
        <label class="lbl" for="biz-type">Business type<span class="req">*</span>
          <i class="tip" data-tip="Select the category that best describes your primary business activity. This affects which card networks and payment methods are available to you.">i</i>
        </label>
        <div class="sel-w"><select class="inp" id="biz-type"><option value="">Select…</option><option>Retail — Physical Store</option><option>eCommerce — Online Only</option><option>Restaurant / Food & Beverage</option><option>Healthcare & Medical</option><option>Professional Services</option><option>Travel & Hospitality</option><option>Software / SaaS</option><option>Non-profit</option><option>Education</option><option>Other</option></select></div>
        <div class="err-msg" id="e-biz-type"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Business type is required</span></div>
      </div>
      <div class="field">
        <label class="lbl" for="mcc">MCC code<span class="req">*</span>
          <i class="tip" data-tip="Merchant Category Code — a 4-digit number assigned by card networks to classify your type of business. Affects interchange rates and processing rules. Contact us if you're unsure which code applies.">i</i>
        </label>
        <div class="sel-w"><select class="inp" id="mcc"><option value="">Select MCC…</option><option value="5411">5411 — Grocery Stores</option><option value="5812">5812 — Eating Places, Restaurants</option><option value="5411">5999 — Miscellaneous Retail</option><option value="7372">7372 — Computer Programming / Software</option><option value="8099">8099 — Health Services</option><option value="5045">5045 — Computers & Peripherals</option><option value="7011">7011 — Hotels & Motels</option><option value="4111">4111 — Transportation</option><option value="7941">8220 — Colleges & Universities</option></select></div>
        <div class="err-msg" id="e-mcc"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>MCC code is required</span></div>
      </div>
    </div>
    <div class="field">
      <label class="lbl" for="biz-desc">Detailed business description<span class="req">*</span>
        <i class="tip" data-tip="Describe what you sell and how. Include product/service types, target customers, and how transactions occur (in-person, online, subscription, etc.). Min 50 characters.">i</i>
      </label>
      <textarea class="inp" id="biz-desc" rows="3" placeholder="Describe your products or services, how customers purchase them, and your typical transaction flow…"></textarea>
      <div class="hint" id="desc-count">0 / 50 minimum characters</div>
      <div class="err-msg" id="e-biz-desc"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Please provide at least 50 characters describing your business</span></div>
    </div>
  </div>

  <div class="sect">
    <div class="sl">Credit card processing methods
      <i class="tip" data-tip="Enter what percentage of your total card volume comes through each channel. All values must add up to exactly 100%." style="background:var(--g400)">i</i>
    </div>
    <div id="proc-total-bar" class="proc-total warn">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
      Total: <span id="proc-total-val">0%</span> — must equal 100%
    </div>
    <div style="margin-top:8px">
      <div class="proc-row"><div class="proc-lbl">eCommerce (card not present)</div><div class="proc-inp-w"><input type="number" min="0" max="100" placeholder="0" class="proc-inp" oninput="updateProcTotal()"></div></div>
      <div class="proc-row"><div class="proc-lbl">Mail order / telephone order (MOTO)</div><div class="proc-inp-w"><input type="number" min="0" max="100" placeholder="0" class="proc-inp" oninput="updateProcTotal()"></div></div>
      <div class="proc-row"><div class="proc-lbl">Manually keyed — card present with imprint</div><div class="proc-inp-w"><input type="number" min="0" max="100" placeholder="0" class="proc-inp" oninput="updateProcTotal()"></div></div>
      <div class="proc-row"><div class="proc-lbl">Present / swipe / tap (in-person POS)</div><div class="proc-inp-w"><input type="number" min="0" max="100" placeholder="0" class="proc-inp" oninput="updateProcTotal()"></div></div>
      <div class="proc-row"><div class="proc-lbl">Business-to-business (B2B)</div><div class="proc-inp-w"><input type="number" min="0" max="100" placeholder="0" class="proc-inp" oninput="updateProcTotal()"></div></div>
    </div>
    <div class="err-msg" id="e-proc" style="margin-top:4px"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Processing method percentages must total exactly 100%</span></div>
  </div>

  <div class="sect">
    <div class="sl">Transaction volume
      <i class="tip" data-tip="Provide your best estimate. Underestimating volume can cause account holds. You can update these figures after account activation." style="background:var(--g400)">i</i>
    </div>
    <div class="gr2">
      <div class="field">
        <label class="lbl" for="avg-vol">Avg. monthly volume<span class="req">*</span>
          <i class="tip" data-tip="Your typical monthly credit and debit card processing volume in USD. Use a 3-month average if available.">i</i>
        </label>
        <div class="inp-pfx"><span class="pfx">$</span><input class="inp" id="avg-vol" type="number" min="0" placeholder="0"></div>
        <div class="err-msg" id="e-avg-vol"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Average monthly volume is required</span></div>
      </div>
      <div class="field">
        <label class="lbl" for="high-vol">High monthly volume<span class="req">*</span>
          <i class="tip" data-tip="Your peak monthly processing volume — e.g. during holiday season. Must be greater than or equal to average monthly volume.">i</i>
        </label>
        <div class="inp-pfx"><span class="pfx">$</span><input class="inp" id="high-vol" type="number" min="0" placeholder="0"></div>
        <div class="err-msg" id="e-high-vol"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Must be ≥ average volume</span></div>
      </div>
    </div>
    <div class="gr2">
      <div class="field">
        <label class="lbl" for="avg-ticket">Average ticket size<span class="req">*</span>
          <i class="tip" data-tip="The average dollar amount per transaction. Example: if you process $10,000/month across 100 transactions, your average ticket is $100.">i</i>
        </label>
        <div class="inp-pfx"><span class="pfx">$</span><input class="inp" id="avg-ticket" type="number" min="0" placeholder="0"></div>
        <div class="err-msg" id="e-avg-ticket"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Average ticket size is required</span></div>
      </div>
      <div class="field">
        <label class="lbl" for="high-ticket">High ticket size<span class="req">*</span>
          <i class="tip" data-tip="The largest single transaction amount you expect to process. Must be ≥ average ticket. Large high-ticket amounts may require additional documentation.">i</i>
        </label>
        <div class="inp-pfx"><span class="pfx">$</span><input class="inp" id="high-ticket" type="number" min="0" placeholder="0"></div>
        <div class="err-msg" id="e-high-ticket"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Must be ≥ average ticket</span></div>
      </div>
    </div>
    <div class="field">
      <label class="lbl" for="fulfillment-time">How long after payment do customers receive goods/services?<span class="req">*</span>
        <i class="tip" data-tip="Delayed fulfillment increases chargeback risk. If > 7 days, additional documentation or a reserve may be required by the underwriting team.">i</i>
      </label>
      <div class="sel-w"><select class="inp" id="fulfillment-time"><option value="">Select…</option><option>Immediately / at time of purchase</option><option>1–3 days</option><option>4–7 days</option><option>8–14 days</option><option>15–30 days</option><option>More than 30 days</option></select></div>
      <div class="err-msg" id="e-fulfillment-time"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Fulfillment time is required</span></div>
    </div>
    <div class="field">
      <label class="lbl" for="refund-policy">Return & refund policy<span class="req">*</span>
        <i class="tip" data-tip="A clear refund policy reduces chargebacks. Include timeframe, conditions, and how customers can request refunds. This will be reviewed by underwriting.">i</i>
      </label>
      <input class="inp" id="refund-policy" type="text" placeholder="e.g. Full refund within 30 days with original receipt, no questions asked">
      <div class="err-msg" id="e-refund-policy"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Refund policy is required</span></div>
    </div>
  </div>

  <div class="sect">
    <div class="sl">Compliance questions</div>
    <div class="field">
      <label class="lbl">Is your website / location PCI compliant?<span class="req">*</span>
        <i class="tip" data-tip="PCI DSS compliance is required by all card brands. Non-compliant merchants may face higher fees or processing restrictions. Visit pcisecuritystandards.org to learn more.">i</i>
      </label>
      <div class="rg" id="rg-pci"><label class="rp" onclick="pickR(this,'pci')"><input type="radio" name="pci" value="no">No</label><label class="rp" onclick="pickR(this,'pci')"><input type="radio" name="pci" value="yes">Yes — PCI compliant</label></div>
      <div class="err-msg" id="e-pci"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Please answer this question</span></div>
    </div>
    <div class="field">
      <label class="lbl">Have you accepted credit cards before?<span class="req">*</span>
        <i class="tip" data-tip="If yes, you may be asked to provide processing history (statements) to help establish your risk profile and volume limits.">i</i>
      </label>
      <div class="rg" id="rg-prev-cc"><label class="rp" onclick="pickR(this,'prev_cc')"><input type="radio" name="prev_cc" value="no">No — first time</label><label class="rp" onclick="pickR(this,'prev_cc')"><input type="radio" name="prev_cc" value="yes">Yes</label></div>
      <div class="err-msg" id="e-prev-cc"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Please answer this question</span></div>
    </div>
    <div class="field">
      <label class="lbl">Have you ever been terminated by a payment processor?<span class="req">*</span>
        <i class="tip" data-tip="Merchant termination is recorded in the MATCH (TMF) list. Providing accurate information is required. Non-disclosure may result in application denial or account termination.">i</i>
      </label>
      <div class="rg" id="rg-terminated"><label class="rp" onclick="pickR(this,'terminated')"><input type="radio" name="terminated" value="no">No</label><label class="rp" onclick="pickR(this,'terminated')"><input type="radio" name="terminated" value="yes">Yes — please describe in notes</label></div>
      <div class="err-msg" id="e-terminated"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Please answer this question</span></div>
    </div>
    <div class="field">
      <label class="lbl">Third-party fulfillment house?
        <i class="tip" data-tip="If a third party ships or fulfills orders on your behalf, this affects chargeback liability. Examples: dropshipping providers, 3PL warehouses.">i</i>
      </label>
      <div class="rg"><label class="rp" onclick="pickR(this,'3pf')"><input type="radio" name="3pf" value="no">No</label><label class="rp" onclick="pickR(this,'3pf')"><input type="radio" name="3pf" value="yes">Yes</label></div>
    </div>
    <div class="field">
      <label class="lbl">Seasonal business?
        <i class="tip" data-tip="Seasonal businesses may have significantly higher volume at certain times. This helps us set appropriate monthly volume limits to avoid holds.">i</i>
      </label>
      <div class="rg"><label class="rp" onclick="pickR(this,'seasonal')"><input type="radio" name="seasonal" value="no">No</label><label class="rp" onclick="pickR(this,'seasonal')"><input type="radio" name="seasonal" value="yes">Yes</label></div>
    </div>
  </div>

  <div class="sect" style="margin-bottom:0">
    <div class="sl">Additional details</div>
    <div class="gr2">
      <div class="field">
        <label class="lbl" for="num-locations">Number of physical locations
          <i class="tip" data-tip="Count of brick-and-mortar locations where payments are accepted. Each additional location may require a separate application.">i</i>
        </label>
        <input class="inp" id="num-locations" type="number" min="0" placeholder="1">
      </div>
      <div class="field">
        <label class="lbl" for="existing-mid">Existing Pay.com Merchant ID <span class="opt">(if applicable)</span>
          <i class="tip" data-tip="If you are affiliated with an existing Pay.com account, provide the MID here to link your accounts.">i</i>
        </label>
        <input class="inp" id="existing-mid" type="text" placeholder="e.g. MID-000000">
      </div>
    </div>
    <div class="field">
      <label class="lbl">Annual American Express volume exceed $1 million?
        <i class="tip" data-tip="Merchants processing over $1M annually with American Express are eligible for OptBlue pricing. Answer accurately as it affects your Amex agreement type.">i</i>
      </label>
      <div class="rg"><label class="rp" onclick="pickR(this,'amex_vol')"><input type="radio" name="amex_vol" value="no">No</label><label class="rp" onclick="pickR(this,'amex_vol')"><input type="radio" name="amex_vol" value="yes">Yes</label></div>
    </div>
    <div class="field">
      <label class="lbl">Receive American Express marketing materials?</label>
      <div class="rg"><label class="rp" onclick="pickR(this,'amex_mkt')"><input type="radio" name="amex_mkt" value="no">No</label><label class="rp" onclick="pickR(this,'amex_mkt')"><input type="radio" name="amex_mkt" value="yes">Yes</label></div>
    </div>
  </div>

  <div class="sf">
    <button class="btn-g" onclick="goStep(0)"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>Back</button>
    <button class="btn-p" onclick="validateAndNext(1)">Continue to Banking information <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></button>
  </div>
</div>
</div>


<!-- ╔══════════════════════════════════════════╗
     ║  STEP 2 — BANKING INFORMATION           ║
     ╚══════════════════════════════════════════╝ -->
<div class="sv" id="sv-2">
<div class="card">
  <div class="card-head">
    <div class="step-dots" id="dots-2"></div>
    <div class="chip">Step 3 of 5</div>
    <h1 class="card-title">Banking information</h1>
    <p class="card-sub">Provide your bank account details for settlement deposits.</p>
    <div class="lu-bar" id="lu-2">
      <div class="lu-bar-left">
        <svg class="lu-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        <span class="lu-text" id="lu-2-txt">Not yet saved</span>
      </div>
      <div style="display:flex;align-items:center;gap:10px">
        <span class="lu-autosave" id="lu-2-status" style="display:none">
          <span class="lu-autosave-dot"></span>Saved
        </span>
        <button class="lu-history-btn" onclick="openActivityPanel()">View history</button>
      </div>
    </div>
  </div>
  <div class="val-sum" id="vs-2"><div class="val-sum-title"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>Please fix the following errors</div><ul id="vl-2"></ul></div>

  <div class="banner info"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg><span>Your banking details are encrypted with AES-256 and never stored in plain text. We only use these for settlement deposits.</span></div>

  <div class="sect">
    <div class="sl">Settlement account</div>
    <div class="field">
      <label class="lbl" for="bank-name">Financial institution name<span class="req">*</span>
        <i class="tip" data-tip="Full name of your bank or credit union as it appears on your account statements.">i</i>
      </label>
      <input class="inp" id="bank-name" type="text" placeholder="e.g. Chase Bank, Wells Fargo, Bank of America">
      <div class="err-msg" id="e-bank-name"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Bank name is required</span></div>
    </div>
    <div class="gr2">
      <div class="field">
        <label class="lbl" for="routing">Routing number<span class="req">*</span>
          <i class="tip" data-tip="9-digit ABA routing number. Found at the bottom-left of a check, or in your online banking portal under 'account details'.">i</i>
        </label>
        <div class="inp-ic">
          <input class="inp" id="routing" type="text" placeholder="9-digit routing number" maxlength="9" oninput="this.value=this.value.replace(/\D/g,'');validateRouting()">
          <svg class="ok-ic" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
          <svg class="err-ic" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
        </div>
        <div class="err-msg" id="e-routing"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>9-digit routing number required</span></div>
        <div class="check-img"><span class="check-box">0000</span><span style="color:var(--g300)">|</span><span class="check-box">Routing</span><span style="color:var(--g300)">|</span><span class="check-box">Account</span><span style="color:var(--g500);margin-left:4px">Found at the bottom of a check ↑</span></div>
      </div>
      <div class="field">
        <label class="lbl" for="account-num">Bank account number<span class="req">*</span>
          <i class="tip" data-tip="Your checking or savings account number. Typically 8–12 digits, found on your checks or online banking portal. Do not include spaces or dashes.">i</i>
        </label>
        <div class="inp-ic">
          <input class="inp" id="account-num" type="text" placeholder="Account number" oninput="this.value=this.value.replace(/\D/g,'')">
          <svg class="ok-ic" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
          <svg class="err-ic" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
        </div>
        <div class="err-msg" id="e-account-num"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Account number must be 6–17 digits</span></div>
      </div>
    </div>
    <div class="field">
      <label class="lbl" for="acct-num-confirm">Confirm account number<span class="req">*</span>
        <i class="tip" data-tip="Re-enter your account number to verify accuracy. Incorrect account numbers will delay settlement.">i</i>
      </label>
      <div class="inp-ic">
        <input class="inp" id="acct-num-confirm" type="text" placeholder="Re-enter account number" oninput="this.value=this.value.replace(/\D/g,'')">
        <svg class="ok-ic" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
        <svg class="err-ic" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
      </div>
      <div class="err-msg" id="e-acct-num-confirm"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Account numbers do not match</span></div>
    </div>
    <div class="field">
      <label class="lbl">Type of account<span class="req">*</span>
        <i class="tip" data-tip="Most business accounts should select Business Checking. Personal accounts may be acceptable for sole proprietors but could affect settlement timing.">i</i>
      </label>
      <div class="rg" id="rg-acct-type">
        <label class="rp" onclick="pickR(this,'acct_type')"><input type="radio" name="acct_type" value="checking">Personal Checking</label>
        <label class="rp" onclick="pickR(this,'acct_type')"><input type="radio" name="acct_type" value="savings">Personal Savings</label>
        <label class="rp" onclick="pickR(this,'acct_type')"><input type="radio" name="acct_type" value="biz_checking">Business Checking</label>
        <label class="rp" onclick="pickR(this,'acct_type')"><input type="radio" name="acct_type" value="biz_savings">Business Savings</label>
      </div>
      <div class="err-msg" id="e-acct-type"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Please select account type</span></div>
    </div>
  </div>

  <div class="sf">
    <button class="btn-g" onclick="goStep(1)"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>Back</button>
    <button class="btn-p" onclick="validateAndNext(2)">Continue to Beneficial owners <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></button>
  </div>
</div>
</div>


<!-- ╔══════════════════════════════════════════╗
     ║  STEP 3 — BENEFICIAL OWNER              ║
     ╚══════════════════════════════════════════╝ -->
<div class="sv" id="sv-3">
<div class="card">
  <div class="card-head">
    <div class="step-dots" id="dots-3"></div>
    <div class="chip">Step 4 of 5</div>
    <h1 class="card-title">Beneficial owner information</h1>
    <p class="card-sub">Federal law (FinCEN CDD Rule) requires listing all individuals with <strong>≥10%</strong> ownership of the company.</p>
    <div class="lu-bar" id="lu-3">
      <div class="lu-bar-left">
        <svg class="lu-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        <span class="lu-text" id="lu-3-txt">Not yet saved</span>
      </div>
      <div style="display:flex;align-items:center;gap:10px">
        <span class="lu-autosave" id="lu-3-status" style="display:none">
          <span class="lu-autosave-dot"></span>Saved
        </span>
        <button class="lu-history-btn" onclick="openActivityPanel()">View history</button>
      </div>
    </div>
  </div>

  <div class="banner warn"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg><span>Providing false or incomplete beneficial ownership information is a federal crime under 31 CFR 1010.230. All information is verified against government records.</span></div>

  <div id="ubo-list">
    <div class="empty">
      <div class="ei">👤</div>
      <p>No beneficial owners added yet.<br>Add all individuals who own 10% or more of this company.</p>
      <button class="btn-p" onclick="openUboModal()"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>Add beneficial owner</button>
    </div>
  </div>
  <div id="ubo-add-more" style="display:none;margin-top:10px">
    <button class="add-btn" onclick="openUboModal()"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>Add another beneficial owner</button>
  </div>
  <div class="err-msg" id="e-ubo" style="margin-top:8px"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>You must add at least one beneficial owner, or confirm there are no individuals with ≥10% ownership</span></div>

  <div style="margin-top:14px">
    <label class="chk-row" id="no-ubo-row">
      <input type="checkbox" id="no-ubo" onchange="toggleNoUbo()">
      I confirm there are no individuals with 10% or more ownership (e.g. widely-held public company)
    </label>
  </div>

  <div class="sf">
    <button class="btn-g" onclick="goStep(2)"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>Back</button>
    <button class="btn-p" onclick="validateAndNext(3)">Continue to Individuals <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></button>
  </div>
</div>
</div>


<!-- ╔══════════════════════════════════════════╗
     ║  STEP 4 — INDIVIDUALS                   ║
     ╚══════════════════════════════════════════╝ -->
<div class="sv" id="sv-4">
<div class="card">
  <div class="card-head">
    <div class="step-dots" id="dots-4"></div>
    <div class="chip">Step 5 of 5</div>
    <h1 class="card-title">Individuals information</h1>
    <p class="card-sub">Provide information about key individuals responsible for this account.</p>
    <div class="lu-bar" id="lu-4">
      <div class="lu-bar-left">
        <svg class="lu-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        <span class="lu-text" id="lu-4-txt">Not yet saved</span>
      </div>
      <div style="display:flex;align-items:center;gap:10px">
        <span class="lu-autosave" id="lu-4-status" style="display:none">
          <span class="lu-autosave-dot"></span>Saved
        </span>
        <button class="lu-history-btn" onclick="openActivityPanel()">View history</button>
      </div>
    </div>
  </div>
  <div class="val-sum" id="vs-4"><div class="val-sum-title"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>Please fix the following errors</div><ul id="vl-4"></ul></div>

  <!-- Main Contact -->
  <div class="sect">
    <div class="sl">Main contact</div>
    <div class="gr2">
      <div class="field"><label class="lbl" for="mc-fname">First name<span class="req">*</span></label><input class="inp" id="mc-fname" type="text" placeholder="First name" autocomplete="given-name"><div class="err-msg" id="e-mc-fname"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Required</span></div></div>
      <div class="field"><label class="lbl" for="mc-lname">Last name<span class="req">*</span></label><input class="inp" id="mc-lname" type="text" placeholder="Last name" autocomplete="family-name"><div class="err-msg" id="e-mc-lname"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Required</span></div></div>
    </div>
    <div class="gr2">
      <div class="field"><label class="lbl" for="mc-title">Title / Role<span class="req">*</span><i class="tip" data-tip="Job title of the main contact person, e.g. CEO, Owner, Finance Director.">i</i></label><input class="inp" id="mc-title" type="text" placeholder="e.g. CEO, Owner, CFO"><div class="err-msg" id="e-mc-title"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Title is required</span></div></div>
      <div class="field"><label class="lbl" for="mc-email">Email address<span class="req">*</span></label><div class="inp-ic"><input class="inp" id="mc-email" type="email" placeholder="contact@company.com" autocomplete="email"><svg class="ok-ic" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg><svg class="err-ic" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg></div><div class="err-msg" id="e-mc-email"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Valid email address required</span></div></div>
    </div>
    <div class="field"><label class="lbl" for="mc-phone">Phone number<span class="req">*</span></label><div class="ph-row"><div class="sel-w"><select class="inp"><option>🇺🇸 +1</option></select></div><input class="inp" id="mc-phone" type="tel" placeholder="(555) 000-0000"></div><div class="err-msg" id="e-mc-phone"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Valid US phone number required</span></div></div>
  </div>

  <!-- Chargebacks (collapsible) -->
  <div class="sect">
    <div class="col-hd" id="cb-hd" onclick="toggleCol('cb-bd','cb-hd')">
      <span style="display:flex;align-items:center;gap:8px">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 .49-4.5"/></svg>
        Chargebacks contact
        <i class="tip" data-tip="The person who handles chargeback disputes and representment responses. If left blank, the main contact will be used." style="pointer-events:auto">i</i>
        <span style="font-size:11px;font-weight:400;color:var(--g400)">(if different from main contact)</span>
      </span>
      <span class="arr">▼</span>
    </div>
    <div class="col-bd" id="cb-bd">
      <div class="gr2">
        <div class="field"><label class="lbl" for="cb-fname">First name</label><input class="inp" id="cb-fname" type="text" placeholder="First name"></div>
        <div class="field"><label class="lbl" for="cb-lname">Last name</label><input class="inp" id="cb-lname" type="text" placeholder="Last name"></div>
      </div>
      <div class="gr2">
        <div class="field"><label class="lbl" for="cb-title">Title</label><input class="inp" id="cb-title" type="text" placeholder="e.g. Finance Manager"></div>
        <div class="field"><label class="lbl" for="cb-email">Email</label><input class="inp" id="cb-email" type="email" placeholder="chargebacks@company.com"></div>
      </div>
      <div class="field"><label class="lbl">Phone</label><div class="ph-row"><div class="sel-w"><select class="inp"><option>🇺🇸 +1</option></select></div><input class="inp" type="tel" placeholder="(555) 000-0000"></div></div>
    </div>
  </div>

  <!-- Authorized Signer -->
  <div class="sect" style="margin-bottom:0">
    <div class="sl">Authorized signer
      <i class="tip" data-tip="The individual legally authorized to enter into agreements on behalf of the business. Must be an officer, director, or managing member." style="background:var(--g400)">i</i>
    </div>
    <div class="banner info" style="margin-bottom:14px"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg><span>The signer must be authorized to enter into legal agreements for this business. Their identity will be verified against government records.</span></div>
    <div class="gr2">
      <div class="field"><label class="lbl" for="sg-fname">First name<span class="req">*</span></label><input class="inp" id="sg-fname" type="text" placeholder="First name"><div class="err-msg" id="e-sg-fname"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Required</span></div></div>
      <div class="field"><label class="lbl" for="sg-lname">Last name<span class="req">*</span></label><input class="inp" id="sg-lname" type="text" placeholder="Last name"><div class="err-msg" id="e-sg-lname"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Required</span></div></div>
    </div>
    <div class="gr2">
      <div class="field"><label class="lbl" for="sg-title">Title / Role<span class="req">*</span><i class="tip" data-tip="e.g. President, CEO, Managing Member, General Partner. Must reflect an officer-level position.">i</i></label><input class="inp" id="sg-title" type="text" placeholder="e.g. President, Managing Member"><div class="err-msg" id="e-sg-title"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Title is required</span></div></div>
      <div class="field"><label class="lbl" for="sg-dob">Date of birth<span class="req">*</span><i class="tip" data-tip="Used for identity verification. Must be 18 years or older.">i</i></label><input class="inp" id="sg-dob" type="text" placeholder="MM/DD/YYYY" onfocus="this.type='date'" onblur="if(!this.value)this.type='text'"><div class="err-msg" id="e-sg-dob"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Must be 18+ years old</span></div></div>
    </div>
    <div class="gr2">
      <div class="field"><label class="lbl" for="sg-nationality">Nationality<span class="req">*</span></label><div class="sel-w"><select class="inp" id="sg-nationality"><option value="">Select…</option><option value="US">United States</option><option value="UK">United Kingdom</option><option value="CA">Canada</option><option value="other">Other</option></select></div><div class="err-msg" id="e-sg-nationality"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Nationality is required</span></div></div>
      <div class="field"><label class="lbl" for="sg-ssn">Social Security Number<span class="req">*</span><i class="tip" data-tip="Required for identity verification per FinCEN requirements. Stored encrypted. Format: XXX-XX-XXXX. Non-US citizens may provide ITIN.">i</i></label><div class="inp-ic"><input class="inp" id="sg-ssn" type="password" placeholder="XXX-XX-XXXX" maxlength="11"><svg class="ok-ic" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg><svg class="err-ic" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg></div><div class="err-msg" id="e-sg-ssn"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Valid SSN/ITIN required (XXX-XX-XXXX)</span></div></div>
    </div>
    <div class="field"><label class="lbl" for="sg-addr1">Signer address<span class="req">*</span></label><input class="inp" id="sg-addr1" type="text" placeholder="Address line 1" style="margin-bottom:6px"><input class="inp" type="text" placeholder="Address line 2 (optional)" style="margin-bottom:6px"><div class="gr3"><input class="inp" id="sg-city" type="text" placeholder="City"><div class="sel-w"><select class="inp" id="sg-state"><option value="">State…</option><option>AL</option><option>AK</option><option>AZ</option><option>AR</option><option>CA</option><option>CO</option><option>CT</option><option>DE</option><option>FL</option><option>GA</option><option>HI</option><option>ID</option><option>IL</option><option>IN</option><option>IA</option><option>KS</option><option>KY</option><option>LA</option><option>ME</option><option>MD</option><option>MA</option><option>MI</option><option>MN</option><option>MS</option><option>MO</option><option>MT</option><option>NE</option><option>NV</option><option>NH</option><option>NJ</option><option>NM</option><option>NY</option><option>NC</option><option>ND</option><option>OH</option><option>OK</option><option>OR</option><option>PA</option><option>RI</option><option>SC</option><option>SD</option><option>TN</option><option>TX</option><option>UT</option><option>VT</option><option>VA</option><option>WA</option><option>WV</option><option>WI</option><option>WY</option><option>DC</option></select></div><input class="inp" id="sg-zip" type="text" placeholder="ZIP" maxlength="10"></div><div class="err-msg" id="e-sg-addr1"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Complete address is required</span></div></div>
    <div class="gr2">
      <div class="field"><label class="lbl" for="sg-phone">Phone<span class="req">*</span></label><div class="ph-row"><div class="sel-w"><select class="inp"><option>🇺🇸 +1</option></select></div><input class="inp" id="sg-phone" type="tel" placeholder="(555) 000-0000"></div><div class="err-msg" id="e-sg-phone"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Valid phone required</span></div></div>
      <div class="field"><label class="lbl" for="sg-email">Email<span class="req">*</span></label><input class="inp" id="sg-email" type="email" placeholder="signer@company.com"><div class="err-msg" id="e-sg-email"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Valid email required</span></div></div>
    </div>

    <!-- eSignature agreement -->
    <div style="margin-top:8px;background:var(--g50);border:1.5px solid var(--g150);border-radius:var(--r);padding:14px 14px">
      <div style="font-size:12px;color:var(--g600);line-height:1.6;margin-bottom:12px">By submitting this application, the authorized signer agrees to Pay.com's <a href="#" style="color:var(--brand)">Merchant Processing Agreement</a>, <a href="#" style="color:var(--brand)">Privacy Policy</a>, and <a href="#" style="color:var(--brand)">Program Guide</a>. The signer certifies that all information provided is true and accurate.</div>
      <label class="chk-row" style="margin-bottom:0">
        <input type="checkbox" id="agree-terms">
        <span>I agree to the Merchant Processing Agreement and certify that I am authorized to sign on behalf of this business<span class="req">*</span></span>
      </label>
      <div class="err-msg" id="e-agree-terms"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>You must agree to the terms to submit</span></div>
    </div>
  </div>

  <div class="sf">
    <button class="btn-g" onclick="goStep(3)"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>Back</button>
    <button class="btn-p" onclick="validateAndNext(4)">Submit application <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg></button>
  </div>
</div>
</div>


<!-- ╔══════════════════════════════════════════╗
     ║  SUCCESS                                 ║
     ╚══════════════════════════════════════════╝ -->
<div class="sv" id="sv-success">
  <div class="success-wrap">
    <div class="suc-icon"><svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg></div>
    <h1>Application submitted!</h1>
    <p>Thank you for completing your merchant onboarding. Our underwriting team will review your application and reach out within 1–2 business days.</p>
    <div class="ref" id="ref-num">REF-2026-MRC-0000</div>
    <div style="display:flex;flex-direction:column;gap:8px;align-items:center">
      <button class="btn-p">Go to dashboard <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></button>
      <button class="btn-g" style="margin-top:4px" onclick="startOver()">Start a new application</button>
    </div>
  </div>
</div>

</main><!-- /#main -->
</div><!-- /.shell -->


<!-- ══ UBO MODAL ══ -->
<div class="mbg" id="ubo-modal">
  <div class="modal">
    <div class="mh"><h2>Add beneficial owner</h2><button class="close-btn" onclick="closeUboModal()"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div>

    <div class="val-sum" id="vs-ubo"><div class="val-sum-title"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>Please fix errors below</div><ul id="vl-ubo"></ul></div>

    <div class="field"><label class="lbl" for="ubo-title-f">UBO title / role<span class="req">*</span><i class="tip" data-tip="The person's formal title in the company, e.g. CEO, Director, Shareholder.">i</i></label><input class="inp" id="ubo-title-f" type="text" placeholder="e.g. CEO, Director, Shareholder"><div class="err-msg" id="e-ubo-title"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Title is required</span></div></div>
    <div class="gr2">
      <div class="field"><label class="lbl" for="ubo-fname">First name<span class="req">*</span></label><input class="inp" id="ubo-fname" type="text" placeholder="First name"><div class="err-msg" id="e-ubo-fname"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Required</span></div></div>
      <div class="field"><label class="lbl" for="ubo-lname">Last name<span class="req">*</span></label><input class="inp" id="ubo-lname" type="text" placeholder="Last name"><div class="err-msg" id="e-ubo-lname"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Required</span></div></div>
    </div>
    <div class="field"><label class="lbl">Middle name <span class="opt">(optional)</span></label><input class="inp" type="text" placeholder="Middle name"></div>
    <div class="gr2">
      <div class="field"><label class="lbl" for="ubo-dob">Date of birth<span class="req">*</span><i class="tip" data-tip="Used for identity verification per FinCEN CDD requirements.">i</i></label><input class="inp" id="ubo-dob" type="text" placeholder="MM/DD/YYYY" onfocus="this.type='date'" onblur="if(!this.value)this.type='text'"><div class="err-msg" id="e-ubo-dob"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Valid date required (must be 18+)</span></div></div>
      <div class="field"><label class="lbl" for="ubo-pct">Ownership %<span class="req">*</span><i class="tip" data-tip="Must be at least 10% to qualify as a beneficial owner. The total ownership across all owners should not exceed 100%.">i</i></label><div class="inp-sfx"><span class="sfx">%</span><input class="inp" id="ubo-pct" type="number" min="10" max="100" placeholder="e.g. 25"></div><div class="err-msg" id="e-ubo-pct"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Must be between 10–100%</span></div></div>
    </div>
    <div class="gr2">
      <div class="field"><label class="lbl" for="ubo-nationality">Nationality<span class="req">*</span></label><div class="sel-w"><select class="inp" id="ubo-nationality"><option value="">Select…</option><option value="US">United States</option><option value="UK">United Kingdom</option><option value="CA">Canada</option><option value="other">Other</option></select></div><div class="err-msg" id="e-ubo-nat"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Required</span></div></div>
      <div class="field"><label class="lbl" for="ubo-ssn">SSN / ITIN<span class="req">*</span><i class="tip" data-tip="Required for identity verification. Stored encrypted. Non-US citizens may use their ITIN.">i</i></label><input class="inp" id="ubo-ssn" type="password" placeholder="XXX-XX-XXXX" maxlength="11"><div class="err-msg" id="e-ubo-ssn"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Valid SSN/ITIN required</span></div></div>
    </div>

    <div class="sect" style="margin-top:14px">
      <div class="sl">UBO address</div>
      <div class="field"><input class="inp" id="ubo-addr1" type="text" placeholder="Address line 1"><div class="err-msg" id="e-ubo-addr1"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg><span>Address required</span></div></div>
      <div class="field"><input class="inp" type="text" placeholder="Address line 2 (optional)"></div>
      <div class="gr3"><div class="field"><input class="inp" id="ubo-city" type="text" placeholder="City"></div><div class="sel-w field"><select class="inp" id="ubo-state"><option value="">State</option><option>AL</option><option>AK</option><option>AZ</option><option>AR</option><option>CA</option><option>CO</option><option>CT</option><option>DE</option><option>FL</option><option>GA</option><option>HI</option><option>ID</option><option>IL</option><option>IN</option><option>IA</option><option>KS</option><option>KY</option><option>LA</option><option>ME</option><option>MD</option><option>MA</option><option>MI</option><option>MN</option><option>MS</option><option>MO</option><option>MT</option><option>NE</option><option>NV</option><option>NH</option><option>NJ</option><option>NM</option><option>NY</option><option>NC</option><option>ND</option><option>OH</option><option>OK</option><option>OR</option><option>PA</option><option>RI</option><option>SC</option><option>SD</option><option>TN</option><option>TX</option><option>UT</option><option>VT</option><option>VA</option><option>WA</option><option>WV</option><option>WI</option><option>WY</option><option>DC</option></select></div><div class="field"><input class="inp" id="ubo-zip" type="text" placeholder="ZIP" maxlength="10"></div></div>
    </div>

    <div class="gr2">
      <div class="field"><label class="lbl">Phone <span class="opt">(optional)</span></label><input class="inp" id="ubo-phone" type="tel" placeholder="(555) 000-0000"></div>
      <div class="field"><label class="lbl">Email <span class="opt">(optional)</span></label><input class="inp" id="ubo-email" type="email" placeholder="owner@company.com"></div>
    </div>

    <div class="field" style="margin-top:6px">
      <label class="lbl">This person also acts as
        <i class="tip" data-tip="If this beneficial owner is also the authorized signer or handles chargebacks, mark it here to avoid re-entering their information later.">i</i>
      </label>
      <div class="rg">
        <label class="rp" onclick="toggleMultiPill(this)"><input type="checkbox" name="ubo_also" value="signer">Authorized signer</label>
        <label class="rp" onclick="toggleMultiPill(this)"><input type="checkbox" name="ubo_also" value="chargebacks">Chargebacks contact</label>
        <label class="rp" onclick="toggleMultiPill(this)"><input type="checkbox" name="ubo_also" value="neither">Neither</label>
      </div>
    </div>

    <div style="margin-top:18px">
      <button class="btn-p" style="width:100%;justify-content:center" onclick="saveUbo()">Add beneficial owner</button>
    </div>
  </div>
</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
// ══════════════════════════════════════════════
//  STATE
// ══════════════════════════════════════════════
let currentStep = 0;
let unlockedSteps = new Set([0]);
let urls = [];
let ubos = [];
const STEPS = 5;

const STEP_META = [
  { title:'General information', sub:'Business identity & legal details',
    icon:'<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="#8080a0" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>' },
  { title:'Business activity', sub:'Processing & volume details',
    icon:'<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="#8080a0" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>' },
  { title:'Banking information', sub:'Settlement account',
    icon:'<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="#8080a0" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="5" width="20" height="14" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/></svg>' },
  { title:'Beneficial owner information', sub:'Ownership ≥ 10%',
    icon:'<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="#8080a0" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>' },
  { title:'Individuals information', sub:'Contacts & signer',
    icon:'<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="#8080a0" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>' }
];

// ══════════════════════════════════════════════
//  INIT
// ══════════════════════════════════════════════
document.addEventListener('DOMContentLoaded', () => {
  buildNav();
  buildDots();
  updateProgress();
  setupLiveValidation();
});

function buildNav() {
  const nav = document.getElementById('sb-nav');
  nav.innerHTML = STEP_META.map((s,i) => `
    <div class="ni${i===0?' active':''}${i>0?' locked':''}" id="ni-${i}" onclick="tryGoStep(${i})">
      <div class="ni-ic">${s.icon}</div>
      <div>
        <div class="ni-t">${s.title}</div>
        <div class="ni-s">${s.sub}</div>
      </div>
    </div>
  `).join('');
}

function buildDots() {
  for(let i=0;i<STEPS;i++){
    const el=document.getElementById('dots-'+i);
    if(!el)return;
    el.innerHTML=Array.from({length:STEPS},(_,j)=>`<div class="dot${j===i?' on':''}"></div>`).join('');
  }
}

function updateProgress() {
  const pct = ((currentStep + 1) / STEPS) * 100;
  document.getElementById('pf').style.width = pct + '%';
  document.getElementById('pt').textContent = (currentStep+1) + ' / ' + STEPS;
}

function buildNavState() {
  STEP_META.forEach((_,i) => {
    const el = document.getElementById('ni-'+i);
    if(!el) return;
    el.classList.remove('active','done','locked');
    if(i === currentStep) {
      el.classList.add('active');
    } else if(i < currentStep) {
      el.classList.add('done');
    } else if(!unlockedSteps.has(i)) {
      el.classList.add('locked');
    }
    // unlocked future steps (test mode): no class = clickable, no dimming
  });
}

function tryGoStep(n) {
  if(unlockedSteps.has(n)) goStep(n);
}

function goStep(n) {
  const prev = currentStep;
  document.getElementById(prev < STEPS ? 'sv-'+prev : 'sv-success').classList.remove('active');
  currentStep = n;
  unlockedSteps.add(n);
  const target = n >= STEPS ? 'sv-success' : 'sv-'+n;
  document.getElementById(target).classList.add('active');
  buildNavState();
  updateProgress();
  window.scrollTo({top:0,behavior:'smooth'});
}

// ══════════════════════════════════════════════
//  VALIDATION ENGINE
// ══════════════════════════════════════════════
function setErr(id, msg) {
  const inp = document.getElementById(id);
  const errEl = document.getElementById('e-'+id);
  if(inp){ inp.classList.add('err'); inp.classList.remove('ok'); }
  if(errEl){
    if(msg) errEl.querySelector('span').textContent = msg;
    errEl.classList.add('show');
  }
}
function clearErr(id) {
  const inp = document.getElementById(id);
  const errEl = document.getElementById('e-'+id);
  if(inp){ inp.classList.remove('err'); inp.classList.add('ok'); }
  if(errEl) errEl.classList.remove('show');
}
function clearField(id) {
  const inp = document.getElementById(id);
  const errEl = document.getElementById('e-'+id);
  if(inp){ inp.classList.remove('err','ok'); }
  if(errEl) errEl.classList.remove('show');
}
function val(id){ const el=document.getElementById(id); return el?el.value.trim():''; }
function checked(id){ const el=document.getElementById(id); return el?el.checked:false; }
function radioVal(name){ const el=document.querySelector(`input[name="${name}"]:checked`); return el?el.value:null; }

const RE_ZIP = /^\d{5}(-\d{4})?$/;
const RE_PHONE = /^[\d\s\-().+]{10,15}$/;
const RE_EMAIL = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
const RE_EIN = /^\d{2}-\d{7}$/;
const RE_SSN = /^\d{3}-\d{2}-\d{4}$/;
const RE_ROUTING = /^\d{9}$/;
const RE_URL = /^https?:\/\/.+\..+/;

function showValSummary(stepIdx, errors) {
  const vs = document.getElementById('vs-'+stepIdx);
  const vl = document.getElementById('vl-'+stepIdx);
  if(!vs||!vl) return;
  if(errors.length===0){ vs.classList.remove('show'); return; }
  vl.innerHTML = errors.map(e=>`<li>${e}</li>`).join('');
  vs.classList.add('show');
  vs.scrollIntoView({behavior:'smooth',block:'start'});
}

function validateStep0() {
  let errs = [];
  // Legal name
  if(!val('biz-legal-name')){ setErr('biz-legal-name'); errs.push('Business legal name is required'); } else clearErr('biz-legal-name');
  // Date of incorporation
  const doiEl = document.getElementById('doi');
  if(!doiEl||!doiEl.value){ setErr('doi'); errs.push('Date of incorporation is required'); }
  else if(new Date(doiEl.value) >= new Date()){ setErr('doi','Date must be in the past'); errs.push('Date of incorporation must be in the past'); }
  else clearErr('doi');
  // Ownership
  if(!val('ownership')){ setErr('ownership'); errs.push('Type of ownership is required'); } else clearErr('ownership');
  // Tax fields (if visible)
  if(document.getElementById('tax-block').style.display!=='none'){
    if(!val('taxpayer-name')){ setErr('taxpayer-name'); errs.push('Taxpayer name is required'); } else clearErr('taxpayer-name');
    const tt = val('tax-type');
    const tid = val('tax-id');
    if(tt==='EIN'){ if(!RE_EIN.test(tid)){ setErr('tax-id','Invalid EIN format (XX-XXXXXXX)'); errs.push('EIN must be in format XX-XXXXXXX'); } else clearErr('tax-id'); }
    else if(tt==='SSN'||tt==='ITIN'){ if(!RE_SSN.test(tid)){ setErr('tax-id','Invalid format (XXX-XX-XXXX)'); errs.push('SSN/ITIN must be in format XXX-XX-XXXX'); } else clearErr('tax-id'); }
  }
  // Address
  if(!val('addr1')){ setErr('addr1'); errs.push('Street address is required'); } else clearErr('addr1');
  if(!val('city')){ setErr('city'); errs.push('City is required'); } else clearErr('city');
  if(!val('state')){ setErr('state'); errs.push('State is required'); } else clearErr('state');
  if(!RE_ZIP.test(val('zip'))){ setErr('zip'); errs.push('Valid ZIP code required (5 digits)'); } else clearErr('zip');
  // DBA (if open)
  if(document.getElementById('dba-bd').classList.contains('open')){
    if(!val('dba-name')){ setErr('dba-name'); errs.push('DBA name is required'); } else clearErr('dba-name');
    if(!document.getElementById('dba-same').checked){
      if(!val('dba-addr1')){ setErr('dba-addr1'); errs.push('DBA street address is required'); } else clearErr('dba-addr1');
      if(!val('dba-city')){ setErr('dba-city'); errs.push('DBA city is required'); } else clearErr('dba-city');
      if(!RE_ZIP.test(val('dba-zip'))){ setErr('dba-zip'); errs.push('DBA ZIP code required'); } else clearErr('dba-zip');
    }
  }
  // Phone (if filled, validate format)
  const bp = val('biz-phone');
  if(bp && !RE_PHONE.test(bp)){ setErr('biz-phone','Invalid phone format'); errs.push('Invalid business phone format'); } else clearErr('biz-phone');
  const csp = val('cs-phone');
  if(csp && !RE_PHONE.test(csp)){ setErr('cs-phone','Invalid phone format'); errs.push('Invalid customer service phone format'); } else clearErr('cs-phone');
  showValSummary(0, errs);
  return errs.length===0;
}

function validateStep1() {
  let errs = [];
  if(!val('biz-type')){ setErr('biz-type'); errs.push('Business type is required'); } else clearErr('biz-type');
  if(!val('mcc')){ setErr('mcc'); errs.push('MCC code is required'); } else clearErr('mcc');
  const desc = val('biz-desc');
  if(desc.length < 50){ setErr('biz-desc'); errs.push('Business description must be at least 50 characters'); } else clearErr('biz-desc');
  // Processing total
  const total = getProcTotal();
  if(total !== 100){ document.getElementById('e-proc').classList.add('show'); errs.push('Processing method percentages must total 100%'); }
  else document.getElementById('e-proc').classList.remove('show');
  // Volume
  const av = parseFloat(val('avg-vol'));
  const hv = parseFloat(val('high-vol'));
  const at = parseFloat(val('avg-ticket'));
  const ht = parseFloat(val('high-ticket'));
  if(isNaN(av)||av<0){ setErr('avg-vol'); errs.push('Average monthly volume required'); } else clearErr('avg-vol');
  if(isNaN(hv)||hv<av){ setErr('high-vol','Must be ≥ average volume'); errs.push('High monthly volume must be ≥ average volume'); } else clearErr('high-vol');
  if(isNaN(at)||at<=0){ setErr('avg-ticket'); errs.push('Average ticket size required'); } else clearErr('avg-ticket');
  if(isNaN(ht)||ht<at){ setErr('high-ticket','Must be ≥ average ticket'); errs.push('High ticket must be ≥ average ticket'); } else clearErr('high-ticket');
  if(!val('fulfillment-time')){ setErr('fulfillment-time'); errs.push('Fulfillment time is required'); } else clearErr('fulfillment-time');
  if(!val('refund-policy')){ setErr('refund-policy'); errs.push('Refund policy is required'); } else clearErr('refund-policy');
  // Required radio groups
  if(!radioVal('pci')){ document.getElementById('e-pci').classList.add('show'); errs.push('PCI compliance answer required'); } else document.getElementById('e-pci').classList.remove('show');
  if(!radioVal('prev_cc')){ document.getElementById('e-prev-cc').classList.add('show'); errs.push('Prior credit card processing answer required'); } else document.getElementById('e-prev-cc').classList.remove('show');
  if(!radioVal('terminated')){ document.getElementById('e-terminated').classList.add('show'); errs.push('Processor termination answer required'); } else document.getElementById('e-terminated').classList.remove('show');
  showValSummary(1, errs);
  return errs.length===0;
}

function validateStep2() {
  let errs = [];
  if(!val('bank-name')){ setErr('bank-name'); errs.push('Financial institution name required'); } else clearErr('bank-name');
  if(!RE_ROUTING.test(val('routing'))){ setErr('routing'); errs.push('9-digit routing number required'); } else clearErr('routing');
  const acct = val('account-num');
  if(acct.length < 6 || acct.length > 17){ setErr('account-num'); errs.push('Account number must be 6–17 digits'); } else clearErr('account-num');
  if(val('acct-num-confirm')!==acct){ setErr('acct-num-confirm'); errs.push('Account numbers do not match'); } else clearErr('acct-num-confirm');
  if(!radioVal('acct_type')){ document.getElementById('e-acct-type').classList.add('show'); errs.push('Account type is required'); } else document.getElementById('e-acct-type').classList.remove('show');
  showValSummary(2, errs);
  return errs.length===0;
}

function validateStep3() {
  const noUbo = checked('no-ubo');
  const errEl = document.getElementById('e-ubo');
  if(ubos.length===0 && !noUbo){ errEl.classList.add('show'); return false; }
  errEl.classList.remove('show');
  return true;
}

function validateStep4() {
  let errs = [];
  if(!val('mc-fname')){ setErr('mc-fname'); errs.push('Main contact first name required'); } else clearErr('mc-fname');
  if(!val('mc-lname')){ setErr('mc-lname'); errs.push('Main contact last name required'); } else clearErr('mc-lname');
  if(!val('mc-title')){ setErr('mc-title'); errs.push('Main contact title required'); } else clearErr('mc-title');
  if(!RE_EMAIL.test(val('mc-email'))){ setErr('mc-email'); errs.push('Valid main contact email required'); } else clearErr('mc-email');
  if(!RE_PHONE.test(val('mc-phone'))){ setErr('mc-phone'); errs.push('Valid main contact phone required'); } else clearErr('mc-phone');
  // Signer
  if(!val('sg-fname')){ setErr('sg-fname'); errs.push('Signer first name required'); } else clearErr('sg-fname');
  if(!val('sg-lname')){ setErr('sg-lname'); errs.push('Signer last name required'); } else clearErr('sg-lname');
  if(!val('sg-title')){ setErr('sg-title'); errs.push('Signer title required'); } else clearErr('sg-title');
  const sgDob = document.getElementById('sg-dob');
  if(!sgDob||!sgDob.value||!isAdult(sgDob.value)){ setErr('sg-dob'); errs.push('Signer must be 18 years or older'); } else clearErr('sg-dob');
  if(!val('sg-nationality')){ setErr('sg-nationality'); errs.push('Signer nationality required'); } else clearErr('sg-nationality');
  if(!RE_SSN.test(val('sg-ssn'))){ setErr('sg-ssn'); errs.push('Valid SSN/ITIN required for signer'); } else clearErr('sg-ssn');
  if(!val('sg-addr1')||!val('sg-city')||!val('sg-state')||!RE_ZIP.test(val('sg-zip'))){ setErr('sg-addr1','Complete address required'); errs.push('Signer complete address required'); } else clearErr('sg-addr1');
  if(!RE_PHONE.test(val('sg-phone'))){ setErr('sg-phone'); errs.push('Valid signer phone required'); } else clearErr('sg-phone');
  if(!RE_EMAIL.test(val('sg-email'))){ setErr('sg-email'); errs.push('Valid signer email required'); } else clearErr('sg-email');
  if(!checked('agree-terms')){ document.getElementById('e-agree-terms').classList.add('show'); errs.push('You must agree to the terms'); } else document.getElementById('e-agree-terms').classList.remove('show');
  showValSummary(4, errs);
  return errs.length===0;
}

function isAdult(dateStr) {
  const dob = new Date(dateStr);
  const now = new Date();
  const age = now.getFullYear() - dob.getFullYear() - (now < new Date(now.getFullYear(), dob.getMonth(), dob.getDate()) ? 1 : 0);
  return age >= 18;
}

function validateAndNext(stepIdx) {
  const validators = [validateStep0, validateStep1, validateStep2, validateStep3, validateStep4];
  const pass = TEST_MODE ? true : validators[stepIdx]();
  if(pass) {
    if(stepIdx === 4) {
      document.getElementById('ref-num').textContent = 'REF-' + new Date().getFullYear() + '-MRC-' + Math.floor(1000 + Math.random() * 9000);
      goStep(STEPS);
    } else {
      goStep(stepIdx + 1);
    }
  }
}

// ══════════════════════════════════════════════
//  LIVE VALIDATION
// ══════════════════════════════════════════════
function setupLiveValidation() {
  const rules = {
    'biz-legal-name': (v) => v.length>0 ? null : 'Business legal name is required',
    'addr1': (v) => v.length>0 ? null : 'Street address is required',
    'city': (v) => v.length>0 ? null : 'City is required',
    'zip': (v) => RE_ZIP.test(v) ? null : 'Valid 5-digit ZIP code required',
    'bank-name': (v) => v.length>0 ? null : 'Bank name is required',
    'routing': (v) => RE_ROUTING.test(v) ? null : '9-digit routing number required',
    'account-num': (v) => (v.length>=6&&v.length<=17) ? null : 'Account number must be 6–17 digits',
    'mc-fname': (v) => v.length>0 ? null : 'Required',
    'mc-lname': (v) => v.length>0 ? null : 'Required',
    'mc-email': (v) => RE_EMAIL.test(v) ? null : 'Valid email required',
    'mc-phone': (v) => RE_PHONE.test(v)||v==='' ? null : 'Invalid phone format',
    'sg-fname': (v) => v.length>0 ? null : 'Required',
    'sg-lname': (v) => v.length>0 ? null : 'Required',
    'sg-email': (v) => RE_EMAIL.test(v) ? null : 'Valid email required',
    'sg-phone': (v) => RE_PHONE.test(v) ? null : 'Invalid phone format',
  };

  Object.entries(rules).forEach(([id, ruleFn]) => {
    const el = document.getElementById(id);
    if(!el) return;
    el.addEventListener('blur', () => {
      const v = el.value.trim();
      const msg = ruleFn(v);
      if(msg && v!=='') setErr(id, msg);
      else if(!msg && v!=='') clearErr(id);
      else clearField(id);
    });
    el.addEventListener('input', () => {
      if(el.classList.contains('err')) {
        const msg = ruleFn(el.value.trim());
        if(!msg) clearErr(id);
      }
    });
  });

  // Account number confirmation live check
  const acctConfirm = document.getElementById('acct-num-confirm');
  if(acctConfirm){
    acctConfirm.addEventListener('blur', () => {
      if(val('acct-num-confirm')===val('account-num') && val('account-num')!=='') clearErr('acct-num-confirm');
      else if(val('acct-num-confirm')!=='' ) setErr('acct-num-confirm','Account numbers do not match');
    });
  }

  // SSN auto-format
  ['sg-ssn','ubo-ssn'].forEach(id => {
    const el = document.getElementById(id);
    if(!el) return;
    el.addEventListener('input', function(){
      let v = this.value.replace(/\D/g,'');
      if(v.length>3&&v.length<=5) v=v.slice(0,3)+'-'+v.slice(3);
      else if(v.length>5) v=v.slice(0,3)+'-'+v.slice(3,5)+'-'+v.slice(5,9);
      this.value = v;
    });
  });

  // EIN auto-format
  const taxId = document.getElementById('tax-id');
  if(taxId){
    taxId.addEventListener('input', function(){
      const tt = document.getElementById('tax-type')?.value;
      if(tt==='EIN'){
        let v = this.value.replace(/\D/g,'');
        if(v.length>2) v = v.slice(0,2)+'-'+v.slice(2,9);
        this.value = v;
      }
    });
  }

  // Business description character counter
  const desc = document.getElementById('biz-desc');
  const descCount = document.getElementById('desc-count');
  if(desc && descCount){
    desc.addEventListener('input', () => {
      const len = desc.value.trim().length;
      descCount.textContent = len + ' / 50 minimum characters';
      descCount.style.color = len>=50 ? 'var(--green)' : 'var(--g400)';
    });
  }
}

function validateRouting() {
  const v = val('routing');
  if(v.length===9){ clearErr('routing'); }
}

// ══════════════════════════════════════════════
//  STEP 0 HELPERS
// ══════════════════════════════════════════════
function onOwnership() {
  const v = document.getElementById('ownership').value;
  const tb = document.getElementById('tax-block');
  const nf = document.getElementById('nonprofit-ext');
  const tn = document.getElementById('taxpayer-name');
  tb.style.display = v ? 'block' : 'none';
  if(v==='sole_prop'){ document.getElementById('tax-type').value='SSN'; onTaxType(); tn.placeholder='Your full legal name'; }
  else { document.getElementById('tax-type').value='EIN'; onTaxType(); tn.placeholder='As it appears on your tax return'; }
  nf.style.display = v==='nonprofit' ? 'block' : 'none';
  if(v) clearErr('ownership');
}

function onTaxType() {
  const t = document.getElementById('tax-type').value;
  const lbl = document.getElementById('tax-id-lbl');
  const inp = document.getElementById('tax-id');
  const tip = document.getElementById('tax-id-tip');
  if(t==='EIN'){
    lbl.innerHTML = 'EIN number<span class="req">*</span>';
    inp.placeholder = 'XX-XXXXXXX'; inp.maxLength = 11;
    tip.dataset.tip = '9-digit number assigned by the IRS. Format: XX-XXXXXXX. Found on CP-575 notice or prior year tax returns.';
  } else if(t==='SSN'){
    lbl.innerHTML = 'Social Security Number<span class="req">*</span>';
    inp.placeholder = 'XXX-XX-XXXX'; inp.maxLength = 11;
    tip.dataset.tip = 'Your 9-digit Social Security Number. Used for sole proprietors. Encrypted and stored securely.';
  } else {
    lbl.innerHTML = 'ITIN<span class="req">*</span>';
    inp.placeholder = 'XXX-XX-XXXX'; inp.maxLength = 11;
    tip.dataset.tip = 'Individual Taxpayer Identification Number issued by the IRS to individuals who need a US taxpayer ID but are not eligible for an SSN.';
  }
}

function toggleDbaAddr() {
  const checked = document.getElementById('dba-same').checked;
  document.getElementById('dba-addr-fields').style.display = checked ? 'none' : 'block';
}

function toggleCol(bdId, hdId) {
  document.getElementById(bdId).classList.toggle('open');
  document.getElementById(hdId).classList.toggle('open');
}

function showUrlInput() {
  document.getElementById('url-input-row').style.display = 'block';
  document.getElementById('url-input').focus();
}
function cancelUrl() {
  document.getElementById('url-input-row').style.display = 'none';
  document.getElementById('url-input').value = '';
  document.getElementById('e-url').classList.remove('show');
}
function confirmUrl() {
  const v = document.getElementById('url-input').value.trim();
  if(!RE_URL.test(v)){ document.getElementById('e-url').classList.add('show'); return; }
  document.getElementById('e-url').classList.remove('show');
  if(!urls.includes(v)) urls.push(v);
  renderUrlTags();
  document.getElementById('url-input').value = '';
  document.getElementById('url-input-row').style.display = 'none';
}
document.addEventListener('DOMContentLoaded',() => {
  const ui = document.getElementById('url-input');
  if(ui) ui.addEventListener('keydown',e=>{ if(e.key==='Enter')confirmUrl(); if(e.key==='Escape')cancelUrl(); });
});
function removeUrl(i){ urls.splice(i,1); renderUrlTags(); }
function renderUrlTags(){
  document.getElementById('url-tags').innerHTML = urls.map((u,i)=>`<span class="tag">${u}<button onclick="removeUrl(${i})" title="Remove">×</button></span>`).join('');
}

// ══════════════════════════════════════════════
//  STEP 1 HELPERS
// ══════════════════════════════════════════════
function getProcTotal(){
  return Array.from(document.querySelectorAll('.proc-inp')).reduce((s,el)=>s+(parseFloat(el.value)||0),0);
}
function updateProcTotal(){
  const total = getProcTotal();
  const bar = document.getElementById('proc-total-bar');
  const valEl = document.getElementById('proc-total-val');
  valEl.textContent = total + '%';
  bar.className = 'proc-total ' + (total===100?'ok':total>100?'over':'warn');
  bar.innerHTML = bar.innerHTML.replace(/Total:.*must/, `Total: <span id="proc-total-val">${total}%</span> — ${total===100?'✓ Exactly 100%':total>100?'Over 100% — reduce values':'must equal 100%'}`);
  if(total===100) document.getElementById('e-proc').classList.remove('show');
}

// ══════════════════════════════════════════════
//  STEP 3 HELPERS (UBO)
// ══════════════════════════════════════════════
function openUboModal(){ document.getElementById('ubo-modal').classList.add('open'); }
function closeUboModal(){ document.getElementById('ubo-modal').classList.remove('open'); resetUboModal(); }
document.addEventListener('DOMContentLoaded',()=>{
  const m = document.getElementById('ubo-modal');
  if(m) m.addEventListener('click',e=>{ if(e.target===m) closeUboModal(); });
});

function resetUboModal(){
  ['ubo-title-f','ubo-fname','ubo-lname','ubo-dob','ubo-pct','ubo-ssn','ubo-addr1','ubo-city','ubo-zip','ubo-phone','ubo-email'].forEach(id=>{
    const el = document.getElementById(id); if(el) el.value = '';
  });
  document.getElementById('ubo-nationality').value='';
  document.getElementById('ubo-state').value='';
  document.querySelectorAll('[name="ubo_also"]').forEach(c=>{ c.checked=false; c.closest('.rp').classList.remove('on'); });
  ['vs-ubo','e-ubo-title','e-ubo-fname','e-ubo-lname','e-ubo-dob','e-ubo-pct','e-ubo-nat','e-ubo-ssn','e-ubo-addr1'].forEach(id=>{
    const el=document.getElementById(id); if(el){ el.classList.remove('show'); }
  });
  document.getElementById('vs-ubo').classList.remove('show');
}

function saveUbo(){
  let errs=[];
  const title=val('ubo-title-f'),fname=val('ubo-fname'),lname=val('ubo-lname');
  const dobEl=document.getElementById('ubo-dob');
  const pct=parseFloat(val('ubo-pct'));
  const nat=val('ubo-nationality');
  const ssn=val('ubo-ssn');
  const addr1=val('ubo-addr1');

  if(!title){ setErr('ubo-title'); errs.push('Title required'); } else clearErr('ubo-title');
  if(!fname){ setErr('ubo-fname'); errs.push('First name required'); } else clearErr('ubo-fname');
  if(!lname){ setErr('ubo-lname'); errs.push('Last name required'); } else clearErr('ubo-lname');
  if(!dobEl||!dobEl.value||!isAdult(dobEl.value)){ setErr('ubo-dob'); errs.push('Valid DOB required (18+)'); } else clearErr('ubo-dob');
  if(isNaN(pct)||pct<10||pct>100){ setErr('ubo-pct'); errs.push('Ownership must be 10–100%'); } else clearErr('ubo-pct');
  if(!nat){ setErr('ubo-nat'); errs.push('Nationality required'); } else clearErr('ubo-nat');
  if(!RE_SSN.test(ssn)){ setErr('ubo-ssn'); errs.push('Valid SSN/ITIN required'); } else clearErr('ubo-ssn');
  if(!addr1){ setErr('ubo-addr1'); errs.push('UBO address required'); } else clearErr('ubo-addr1');

  // Check total ownership doesn't exceed 100
  const existingTotal = ubos.reduce((s,u)=>s+u.pct,0);
  if(!isNaN(pct) && existingTotal+pct > 100){ setErr('ubo-pct','Total ownership across all UBOs would exceed 100%'); errs.push('Total ownership would exceed 100%'); }

  if(errs.length>0){
    const vl=document.getElementById('vl-ubo');
    vl.innerHTML=errs.map(e=>`<li>${e}</li>`).join('');
    document.getElementById('vs-ubo').classList.add('show');
    return;
  }

  const roles=Array.from(document.querySelectorAll('[name="ubo_also"]:checked')).map(c=>c.value);
  ubos.push({title,fname,lname,dob:dobEl.value,pct,nat,roles});
  renderUbos();
  closeUboModal();
}

function removeUbo(i){ ubos.splice(i,1); renderUbos(); }

function renderUbos(){
  const list=document.getElementById('ubo-list');
  const more=document.getElementById('ubo-add-more');
  if(ubos.length===0){
    list.innerHTML=`<div class="empty"><div class="ei">👤</div><p>No beneficial owners added yet.<br>Add all individuals who own 10% or more of this company.</p><button class="btn-p" onclick="openUboModal()"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>Add beneficial owner</button></div>`;
    more.style.display='none';
  } else {
    const totalPct = ubos.reduce((s,u)=>s+u.pct,0);
    list.innerHTML=ubos.map((u,i)=>`
      <div class="pc">
        <div>
          <div class="pc-name">${u.fname} ${u.lname}</div>
          <div class="pc-role">${u.title} · ${u.pct}% ownership${u.roles&&u.roles.length?` · Also: ${u.roles.join(', ')}`:''}${totalPct<100?' <span style="color:var(--amber);font-size:11px">('+totalPct+'% total — confirm remaining '+( 100-totalPct)+'% ownership)</span>':''}</div>
        </div>
        <div class="pc-acts">
          <button class="ic-btn del" onclick="removeUbo(${i})" title="Remove"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M8 6V4a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2"/></svg></button>
        </div>
      </div>`).join('');
    more.style.display='block';
  }
}

function toggleNoUbo(){
  const checked = document.getElementById('no-ubo').checked;
  if(checked) document.getElementById('e-ubo').classList.remove('show');
}

// ══════════════════════════════════════════════
//  RADIO / CHECKBOX PILLS
// ══════════════════════════════════════════════
function pickR(el, name){
  document.querySelectorAll(`input[name="${name}"]`).forEach(r=>r.closest('.rp').classList.remove('on'));
  el.classList.add('on');
}
function toggleMultiPill(el){
  el.classList.toggle('on');
}


// ── Mobile drawer ──────────────────────────
function openMobDrawer(){
  document.getElementById('mob-drawer').classList.add('open');
  document.getElementById('mob-drawer-bg').classList.add('open');
  syncMobDrawer();
}
function closeMobDrawer(){
  document.getElementById('mob-drawer').classList.remove('open');
  document.getElementById('mob-drawer-bg').classList.remove('open');
}
function syncMobDrawer(){
  const src = document.getElementById('sb-nav').innerHTML;
  document.getElementById('mob-drawer-nav').innerHTML = src;
  // re-bind clicks in drawer
  document.querySelectorAll('#mob-drawer-nav .ni').forEach((el,i)=>{
    el.onclick = function(){
      if(!this.classList.contains('locked')){ closeMobDrawer(); tryGoStep(i); }
    };
  });
}
function updateMobProgress(){
  const pct = ((currentStep+1)/STEPS)*100;
  const fill = document.getElementById('mob-pf');
  const fill2 = document.getElementById('mob-pf2');
  const lbl  = document.getElementById('mob-pt');
  const lbl2 = document.getElementById('mob-pt2');
  if(fill)  fill.style.width  = pct+'%';
  if(fill2) fill2.style.width = pct+'%';
  if(lbl)   lbl.textContent   = 'Step '+(currentStep+1)+' of '+STEPS;
  if(lbl2)  lbl2.textContent  = (currentStep+1)+' / '+STEPS;
}
// Hook into existing updateProgress
const _origUpdateProgress = updateProgress;
window.updateProgress = function(){
  _origUpdateProgress();
  updateMobProgress();
};




// ══════════════════════════════════════════════
//  LAST UPDATED & ACTIVITY LOG
// ══════════════════════════════════════════════
var activityLog = [];
var stepLastSaved = [null, null, null, null, null]; // per-step timestamps

function getNow(){ return new Date(); }

function formatRelTime(date){
  if(!date) return 'Not yet saved';
  var diff = Math.floor((getNow() - date) / 1000);
  if(diff < 5)  return 'Just now';
  if(diff < 60) return diff + 's ago';
  var m = Math.floor(diff/60);
  if(m < 60) return m + 'm ago';
  var h = Math.floor(m/60);
  if(h < 24) return h + 'h ago';
  return date.toLocaleDateString('en-US',{month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'});
}

function formatAbsTime(date){
  if(!date) return '';
  return date.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'}) +
    ' at ' + date.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'});
}

function recordActivity(type, what, who){
  activityLog.unshift({
    type: type,      // 'save' | 'step' | 'invite'
    what: what,
    who:  who || profileData.name,
    when: getNow()
  });
  if(activityLog.length > 50) activityLog.pop();
  renderActivityLog();
}

function markStepSaved(stepIdx){
  var now = getNow();
  stepLastSaved[stepIdx] = now;

  // Update the lu-bar for this step
  var luTxt = document.getElementById('lu-' + stepIdx + '-txt');
  var luStatus = document.getElementById('lu-' + stepIdx + '-status');
  if(luTxt) luTxt.textContent = 'Last saved: ' + formatAbsTime(now);
  if(luStatus){ luStatus.style.display = 'inline-flex'; luStatus.className = 'lu-autosave'; luStatus.innerHTML = '<span class="lu-autosave-dot"></span>Saved'; }

  // Update sidebar
  updateSidebarLU(now);

  // Flash "Saving..." then "Saved"
  if(luStatus){
    luStatus.className = 'lu-autosave lu-saving';
    luStatus.innerHTML = '<span class="lu-autosave-dot"></span>Saving…';
    setTimeout(function(){
      luStatus.className = 'lu-autosave';
      luStatus.innerHTML = '<span class="lu-autosave-dot"></span>Saved';
    }, 600);
  }
}

function updateSidebarLU(date){
  var el = document.getElementById('sb-lu-text');
  if(!el) return;
  el.textContent = 'Saved ' + formatRelTime(date);
}

// Refresh relative times every 30s
setInterval(function(){
  stepLastSaved.forEach(function(ts, i){
    if(!ts) return;
    var el = document.getElementById('lu-' + i + '-txt');
    if(el) el.textContent = 'Last saved: ' + formatAbsTime(ts);
  });
  // Find most recent
  var latest = stepLastSaved.filter(Boolean).sort(function(a,b){return b-a;})[0];
  if(latest) updateSidebarLU(latest);
}, 30000);

// Hook into validateAndNext to record step completions and mark saved
var _origValidateAndNext = validateAndNext;
window.validateAndNext = function(stepIdx){
  var stepNames = ['General information','Business activity','Banking information','Beneficial owner info','Individuals info'];
  var before = currentStep;
  _origValidateAndNext(stepIdx);
  var testOn = (typeof TEST_MODE !== 'undefined' && TEST_MODE);
  if(currentStep !== before || testOn){
    markStepSaved(stepIdx);
    recordActivity('step', 'Completed: ' + stepNames[stepIdx]);
    if(stepIdx === 4){
      recordActivity('save', 'Application submitted');
    }
  }
};

// Hook into save draft button — track manual saves
document.addEventListener('click', function(e){
  var btn = e.target.closest('.btn-g');
  if(btn && btn.textContent.indexOf('Save draft') !== -1){
    markStepSaved(currentStep);
    recordActivity('save', 'Draft saved — ' + ['General info','Business activity','Banking info','Beneficial owners','Individuals'][currentStep]);
    showToast('Draft saved');
  }
});

// Auto-record field changes (debounced, per-step)
var fieldChangeTimers = {};
document.addEventListener('input', function(e){
  var inp = e.target;
  if(!inp.closest('.card')) return;
  var s = currentStep;
  clearTimeout(fieldChangeTimers[s]);
  fieldChangeTimers[s] = setTimeout(function(){
    // Show "unsaved changes" state
    var luStatus = document.getElementById('lu-' + s + '-status');
    if(luStatus){
      luStatus.style.display = 'inline-flex';
      luStatus.className = 'lu-autosave lu-saving';
      luStatus.innerHTML = '<span class="lu-autosave-dot"></span>Unsaved changes';
    }
  }, 300);
});

// Also record invites in activity log
var _origSendInvite = sendInvite;
window.sendInvite = function(){
  var emailEl = document.getElementById('invite-email');
  var emailBefore = emailEl ? emailEl.value.trim() : '';
  _origSendInvite();
  var emailElAfter = document.getElementById('invite-email');
  if(emailBefore && emailElAfter && emailElAfter.value === '' && emailElAfter.className.indexOf('err') === -1){
    recordActivity('invite', 'Invited ' + emailBefore + ' to collaborate');
  }
};

// Activity panel
function openActivityPanel(){
  document.getElementById('activity-panel').classList.add('open');
}
function closeActivityPanel(){
  document.getElementById('activity-panel').classList.remove('open');
}

function renderActivityLog(){
  var el = document.getElementById('act-body');
  if(!el) return;
  if(activityLog.length === 0){
    el.innerHTML = '<div class="act-empty">No activity yet.<br>Changes will appear here as you fill in the form.</div>';
    return;
  }
  el.innerHTML = activityLog.map(function(e){
    return '<div class="act-entry">' +
      '<div class="act-dot ' + e.type + '"></div>' +
      '<div class="act-info">' +
        '<div class="act-what">' + e.what + '</div>' +
        '<div class="act-when">' + formatAbsTime(e.when) + '</div>' +
        '<div class="act-who">by ' + e.who + '</div>' +
      '</div>' +
    '</div>';
  }).join('');
}

// Seed initial activity entry
document.addEventListener('DOMContentLoaded', function(){
  recordActivity('step', 'Onboarding started', profileData.name);
});

// ══════════════════════════════════════════════
//  PROFILE & TEAM
// ══════════════════════════════════════════════

// ── Seed data ──
let profileData = {
  name: 'John Doe',
  email: 'john@acmecorp.com',
  initials: 'JD'
};

let teamMembers = [
  { id:1, name:'Sarah Chen',    email:'sarah@acmecorp.com',  role:'editor', dur:'forever', expiresAt:null,            status:'active',  isOwner:true  },
];

let selectedDur = '1d';
let editingField = null;

function openProfile(){
  renderTeamList();
  updateTeamBadge();
  document.getElementById('prof-modal').classList.add('open');
}
function closeProfile(){
  document.getElementById('prof-modal').classList.remove('open');
  cancelEditField();
}
document.addEventListener('DOMContentLoaded',()=>{
  const bg = document.getElementById('prof-modal');
  if(bg) bg.addEventListener('click', e => { if(e.target===bg) closeProfile(); });
  renderTeamList();
  updateTeamBadge();
});

// ── Tabs ──
function switchProfTab(tab, el){
  document.querySelectorAll('.prof-tab').forEach(t=>t.classList.remove('on'));
  document.querySelectorAll('.prof-tab-content').forEach(t=>t.classList.remove('on'));
  el.classList.add('on');
  document.getElementById('tab-'+tab).classList.add('on');
}

// ── Duration pills ──
function pickDur(el, val){
  document.querySelectorAll('.dur-pill').forEach(p=>p.classList.remove('on'));
  el.classList.add('on');
  selectedDur = val;
}

// ── Invite ──
function sendInvite(){
  const email = document.getElementById('invite-email').value.trim();
  const role  = document.getElementById('invite-role').value;
  const errEl = document.getElementById('e-invite-email');
  const errMsg = document.getElementById('e-invite-msg');

  // Validate email
  if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){
    errEl.classList.add('show');
    errMsg.textContent = 'Please enter a valid email address';
    document.getElementById('invite-email').classList.add('err');
    return;
  }
  // Check duplicate
  if(teamMembers.find(m=>m.email.toLowerCase()===email.toLowerCase())){
    errEl.classList.add('show');
    errMsg.textContent = email + ' already has access';
    document.getElementById('invite-email').classList.add('err');
    return;
  }
  errEl.classList.remove('show');
  document.getElementById('invite-email').classList.remove('err');

  const now = new Date();
  let expiresAt = null;
  const durMap = {'5h':5*60*60*1000,'1d':24*60*60*1000,'7d':7*24*60*60*1000,'1m':30*24*60*60*1000,'forever':null};
  if(durMap[selectedDur]!==null) expiresAt = new Date(now.getTime() + durMap[selectedDur]);

  // Derive initials & name
  const localPart = email.split('@')[0];
  const nameParts = localPart.replace(/[._-]/g,' ').split(' ');
  const name = nameParts.map(p=>p.charAt(0).toUpperCase()+p.slice(1)).join(' ');
  const initials = nameParts.slice(0,2).map(p=>p[0]?.toUpperCase()||'').join('');

  teamMembers.push({
    id: Date.now(),
    name, email, role, dur: selectedDur,
    expiresAt, status:'pending', isOwner:false, initials
  });

  document.getElementById('invite-email').value = '';
  renderTeamList();
  updateTeamBadge();
  showToast('✉ Invite sent to ' + email);
}

// ── Revoke ──
function revokeAccess(id){
  const m = teamMembers.find(m=>m.id===id);
  if(!m || m.isOwner) return;
  if(!confirm('Revoke access for ' + m.email + '? They will no longer be able to view or edit this application.')) return;
  teamMembers = teamMembers.filter(m=>m.id!==id);
  renderTeamList();
  updateTeamBadge();
  showToast('Access revoked for ' + m.email);
}

// ── Extend ──
function extendAccess(id){
  const m = teamMembers.find(function(x){return x.id===id;});
  if(!m) return;
  // populate extend modal
  document.getElementById('extend-target-name').textContent = m.name;
  document.getElementById('extend-target-email').textContent = m.email;
  document.getElementById('extend-modal-id').value = id;
  // reset pills
  document.querySelectorAll('.ext-pill').forEach(function(p){p.classList.remove('on');});
  document.querySelector('.ext-pill[data-val="7d"]').classList.add('on');
  document.getElementById('extend-modal').classList.add('open');
}
function pickExtPill(el){
  document.querySelectorAll('.ext-pill').forEach(function(p){p.classList.remove('on');});
  el.classList.add('on');
}
function confirmExtend(){
  const id = parseInt(document.getElementById('extend-modal-id').value);
  const m = teamMembers.find(function(x){return x.id===id;});
  if(!m) return;
  const activePill = document.querySelector('.ext-pill.on');
  const key = activePill ? activePill.getAttribute('data-val') : '7d';
  const labels = {'5h':'5 hours','1d':'1 day','7d':'7 days','1m':'1 month','forever':'forever'};
  const durMap = {'5h':5*60*60*1000,'1d':86400000,'7d':7*86400000,'1m':30*86400000,'forever':null};
  m.dur = key;
  m.expiresAt = durMap[key]!==null ? new Date(Date.now()+durMap[key]) : null;
  m.status = 'active';
  closeExtendModal();
  renderTeamList();
  showToast('Access extended to ' + labels[key] + ' for ' + m.email);
}
function closeExtendModal(){
  document.getElementById('extend-modal').classList.remove('open');
}

// ── Resend ──
function resendInvite(id){
  const m = teamMembers.find(m=>m.id===id);
  if(!m) return;
  showToast('✉ Invite resent to ' + m.email);
}

// ── Render team list ──
function renderTeamList(){
  const el = document.getElementById('team-list');
  const countEl = document.getElementById('team-list-count');
  if(!el) return;

  if(teamMembers.length===0){
    el.innerHTML = '<div class="team-empty"><div class="tei">👥</div>No team members yet.<br>Invite a colleague to collaborate on this application.</div>';
    if(countEl) countEl.textContent = '';
    return;
  }
  if(countEl) countEl.textContent = teamMembers.length + ' ' + (teamMembers.length===1?'person':'people');

  el.innerHTML = teamMembers.map(function(m) {
    var ini = m.initials || (m.name||'?').split(' ').slice(0,2).map(function(p){return (p[0]||'').toUpperCase();}).join('');
    var expLabel = formatExpiry(m.expiresAt, m.dur);
    var statusBadge = m.isOwner
      ? '<span class="acc-badge owner">Owner</span>'
      : m.status==='pending'
        ? '<span class="acc-badge pending">&#8987; Pending</span>'
        : (m.expiresAt && new Date()>m.expiresAt)
          ? '<span class="acc-badge expired">Expired</span>'
          : '<span class="acc-badge active">&#9679; Active</span>';
    var roleLbl = m.role==='editor' ? 'Can edit' : m.role==='viewer' ? 'View only' : 'Owner';
    var resendBtn = m.status==='pending' ? '<button class="resend-btn" onclick="resendInvite('+m.id+')">Resend</button>' : '';
    var actions = m.isOwner ? '' :
      '<button class="extend-btn" onclick="extendAccess('+m.id+')" title="Extend access">Extend</button>' +
      '<button class="revoke-btn" onclick="revokeAccess('+m.id+')" title="Revoke access">Revoke</button>' +
      resendBtn;
    var youBadge = m.isOwner ? ' <span style="font-size:10.5px;color:var(--g400);font-weight:400">(you)</span>' : '';
    var expHtml = expLabel ? '<span class="exp-txt">&middot; '+expLabel+'</span>' : '';
    return '<div class="team-card">' +
      '<div class="avatar sm" style="flex-shrink:0">'+ini+'</div>' +
      '<div class="team-card-info">' +
        '<div class="team-card-name">'+m.name+youBadge+'</div>' +
        '<div class="team-card-email">'+m.email+'</div>' +
        '<div class="team-card-meta">'+statusBadge+'<span style="font-size:10.5px;color:var(--g400)">'+roleLbl+'</span>'+expHtml+'</div>' +
      '</div>' +
      '<div style="display:flex;gap:5px;flex-shrink:0;flex-wrap:wrap;justify-content:flex-end">'+actions+'</div>' +
    '</div>';
  }).join('');
}

function formatExpiry(date, dur){
  if(dur==='forever' || !date) return dur==='forever'?'No expiry':'';
  const now = new Date();
  const diff = date - now;
  if(diff<0) return 'Expired';
  const h = Math.floor(diff/3600000);
  const d = Math.floor(diff/86400000);
  if(h<1) return 'Expires < 1h';
  if(h<24) return 'Expires in '+h+'h';
  if(d<2) return 'Expires tomorrow';
  if(d<30) return 'Expires in '+d+'d';
  return 'Expires '+date.toLocaleDateString('en-US',{month:'short',day:'numeric'});
}

function updateTeamBadge(){
  const badge = document.getElementById('team-count-badge');
  const count = teamMembers.filter(m=>!m.isOwner).length;
  if(badge) badge.textContent = count;
}

// ── Profile editing ──
function editProfileField(field){
  editingField = field;
  const block = document.getElementById('prof-edit-block');
  const lbl = document.getElementById('prof-edit-label');
  const inp = document.getElementById('prof-edit-input');
  if(field==='name'){ lbl.textContent='Edit full name'; inp.value=profileData.name; inp.type='text'; }
  else { lbl.textContent='Edit email address'; inp.value=profileData.email; inp.type='email'; }
  block.style.display='block';
  inp.focus();
}
function saveProfileField(){
  const inp = document.getElementById('prof-edit-input').value.trim();
  if(!inp) return;
  if(editingField==='name'){
    profileData.name = inp;
    profileData.initials = inp.split(' ').slice(0,2).map(p=>p[0]?.toUpperCase()||'').join('');
    document.getElementById('pd-name').textContent = inp;
    document.getElementById('prof-head-name').textContent = inp;
    document.getElementById('sb-profile-name').textContent = inp;
    document.getElementById('sb-avatar').textContent = profileData.initials;
    document.getElementById('prof-avatar-lg').textContent = profileData.initials;
    // update owner in team list
    const owner = teamMembers.find(m=>m.isOwner);
    if(owner){ owner.name=inp; owner.initials=profileData.initials; }
  } else {
    profileData.email = inp;
    document.getElementById('pd-email').textContent = inp;
    document.getElementById('prof-head-email').textContent = inp + ' · Account owner';
    document.getElementById('sb-profile-email').textContent = inp;
    const owner = teamMembers.find(m=>m.isOwner);
    if(owner) owner.email = inp;
  }
  renderTeamList();
  cancelEditField();
  showToast('Profile updated');
}
function cancelEditField(){
  editingField=null;
  const block=document.getElementById('prof-edit-block');
  if(block) block.style.display='none';
}

// ── Toast ──
let toastTimer;
function showToast(msg){
  const t=document.getElementById('toast');
  const m=document.getElementById('toast-msg');
  m.textContent=msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>t.classList.remove('show'),3000);
}

// ══════════════════════════════════════════════
//  TEST MODE
// ══════════════════════════════════════════════
let TEST_MODE = false;


function toggleTestMode(){
  const chk = document.getElementById('test-mode-chk');
  if(!chk) return;
  TEST_MODE = chk.checked;
  const row = document.getElementById('test-mode-row');
  const banner = document.getElementById('test-mode-banner');
  if(TEST_MODE){
    if(row) row.classList.add('on');
    if(banner) banner.classList.add('on');
    document.body.classList.add('test-mode');
    unlockedSteps = new Set([0,1,2,3,4]);
    buildNavState();
    if(typeof syncMobDrawer==='function') syncMobDrawer();
  } else {
    if(row) row.classList.remove('on');
    if(banner) banner.classList.remove('on');
    document.body.classList.remove('test-mode');
    unlockedSteps = new Set(Array.from({length: currentStep+1}, function(_,i){return i;}));
    buildNavState();
    if(typeof syncMobDrawer==='function') syncMobDrawer();
    document.querySelectorAll('.inp.err').forEach(function(el){el.classList.remove('err','ok');});
    document.querySelectorAll('.err-msg.show').forEach(function(el){el.classList.remove('show');});
    document.querySelectorAll('.val-sum.show').forEach(function(el){el.classList.remove('show');});
  }
}

// ══════════════════════════════════════════════
//  MISC
// ══════════════════════════════════════════════
function startOver(){
  ubos=[]; urls=[];
  currentStep=0; unlockedSteps=new Set([0]);
  document.getElementById('sv-success').classList.remove('active');
  document.getElementById('sv-0').classList.add('active');
  buildNavState(); updateProgress();
  window.scrollTo({top:0});
}
</script>

<!-- ══ TOOLTIP ENGINE ══ -->
<div id="tt-box" style="position:fixed;z-index:9999;background:#1e1e32;color:#fff;font-family:'DM Sans',sans-serif;font-size:12.5px;font-weight:400;line-height:1.65;padding:11px 15px;border-radius:9px;box-shadow:0 8px 28px rgba(0,0,0,.25);width:300px;pointer-events:none;opacity:0;transition:opacity .15s ease;text-align:left;"></div>
<div id="tt-arrow" style="position:fixed;z-index:9998;width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-top:7px solid #1e1e32;pointer-events:none;opacity:0;transition:opacity .15s ease;"></div>
<script>
(function(){
  const box=document.getElementById('tt-box');
  const arrow=document.getElementById('tt-arrow');
  let hideT;
  function showTip(el){
    clearTimeout(hideT);
    const tip=el.getAttribute('data-tip');
    if(!tip)return;
    box.textContent=tip;
    box.style.opacity='0';
    requestAnimationFrame(()=>{
      const r=el.getBoundingClientRect();
      const bw=box.offsetWidth,bh=box.offsetHeight;
      const margin=12;
      let left=r.left+r.width/2-bw/2;
      if(left<margin)left=margin;
      if(left+bw>window.innerWidth-margin)left=window.innerWidth-bw-margin;
      const spaceAbove=r.top-10;
      let top,arrowTop,flip=false;
      if(spaceAbove>=bh+14){top=r.top-bh-12;arrowTop=r.top-13;}
      else{top=r.bottom+12;arrowTop=r.bottom+4;flip=true;}
      box.style.left=left+'px';box.style.top=top+'px';box.style.opacity='1';
      const ax=r.left+r.width/2-6;
      arrow.style.left=ax+'px';arrow.style.top=arrowTop+'px';
      arrow.style.borderTop=flip?'none':'7px solid #1e1e32';
      arrow.style.borderBottom=flip?'7px solid #1e1e32':'none';
      arrow.style.opacity='1';
    });
  }
  function hideTip(){hideT=setTimeout(()=>{box.style.opacity='0';arrow.style.opacity='0';},80);}
  document.addEventListener('mouseover',function(e){
    const t=e.target.closest('.tip');
    if(t)showTip(t);
  });
  document.addEventListener('mouseout',function(e){
    if(e.target.closest('.tip'))hideTip();
  });
})();
</script>



<!-- ══ PROFILE & TEAM MODAL ══ -->
<div class="prof-bg" id="prof-modal">
  <div class="prof-panel">

    <!-- Header -->
    <div class="prof-head">
      <div class="avatar-wrap">
        <div class="avatar lg" id="prof-avatar-lg">JD</div>
        <div class="online-dot"></div>
      </div>
      <div class="prof-head-info">
        <h2 id="prof-head-name">John Doe</h2>
        <p id="prof-head-email"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="94fefbfcfad4f5f7f9f1f7fbe6e4baf7fbf9">[email&#160;protected]</a> · Account owner</p>
      </div>
      <button class="close-btn" onclick="closeProfile()">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>

    <!-- Tabs -->
    <div class="prof-tabs">
      <div class="prof-tab on" onclick="switchProfTab('details',this)">My profile</div>
      <div class="prof-tab" onclick="switchProfTab('team',this)">Team access <span id="team-count-badge" style="background:var(--brand-light);color:var(--brand);font-size:10px;font-weight:700;padding:1px 6px;border-radius:99px;margin-left:4px">0</span></div>
    </div>

    <!-- Tab: My profile -->
    <div class="prof-tab-content on" id="tab-details">
      <div class="prof-detail-row">
        <div class="prof-detail-label">Full name</div>
        <div class="prof-detail-value" id="pd-name">John Doe</div>
        <button class="prof-detail-edit" onclick="editProfileField('name')">Edit</button>
      </div>
      <div class="prof-detail-row">
        <div class="prof-detail-label">Email</div>
        <div class="prof-detail-value" id="pd-email"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="acc6c3c4c2eccdcfc1c9cfc3dedc82cfc3c1">[email&#160;protected]</a></div>
        <button class="prof-detail-edit" onclick="editProfileField('email')">Edit</button>
      </div>
      <div class="prof-detail-row">
        <div class="prof-detail-label">Role</div>
        <div class="prof-detail-value">Account owner</div>
        <span style="font-size:11px;color:var(--g300)">Cannot change</span>
      </div>
      <div class="prof-detail-row">
        <div class="prof-detail-label">Application</div>
        <div class="prof-detail-value" style="font-family:'DM Mono',monospace;font-size:12px">ACME Corp Inc.</div>
      </div>
      <div class="prof-detail-row">
        <div class="prof-detail-label">Last active</div>
        <div class="prof-detail-value" id="pd-lastactive" style="color:var(--g400)">Just now</div>
      </div>
      <!-- inline edit fields (hidden) -->
      <div id="prof-edit-block" style="display:none;margin-top:14px;background:var(--g50);border:1.5px solid var(--g150);border-radius:var(--r-lg);padding:14px">
        <div class="field" style="margin-bottom:10px">
          <label class="lbl" id="prof-edit-label">Edit name</label>
          <input class="inp" id="prof-edit-input" type="text" placeholder="">
        </div>
        <div style="display:flex;gap:8px">
          <button class="btn-p" style="height:36px;padding:0 16px;font-size:12.5px" onclick="saveProfileField()">Save</button>
          <button class="btn-s" style="height:36px;padding:0 14px;font-size:12.5px" onclick="cancelEditField()">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Tab: Team access -->
    <div class="prof-tab-content" id="tab-team">

      <!-- Invite form -->
      <div class="invite-form">
        <div class="invite-form-title">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></svg>
          Invite a team member
        </div>
        <div class="invite-row">
          <input class="inp" id="invite-email" type="email" placeholder="colleague@company.com" style="height:38px">
          <div class="sel-w">
            <select class="inp" id="invite-role" style="height:38px">
              <option value="editor">Can edit</option>
              <option value="viewer">Can view only</option>
            </select>
          </div>
        </div>
        <div style="margin-top:10px">
          <div style="font-size:11.5px;color:var(--g500);margin-bottom:6px;font-weight:500">Access duration:</div>
          <div class="dur-group" id="dur-group">
            <span class="dur-pill" onclick="pickDur(this,'5h')">5 hours</span>
            <span class="dur-pill on" onclick="pickDur(this,'1d')">1 day</span>
            <span class="dur-pill" onclick="pickDur(this,'7d')">7 days</span>
            <span class="dur-pill" onclick="pickDur(this,'1m')">1 month</span>
            <span class="dur-pill" onclick="pickDur(this,'forever')">Forever</span>
          </div>
        </div>
        <div class="err-msg" id="e-invite-email" style="margin-top:8px">
          <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/></svg>
          <span id="e-invite-msg">Valid email address required</span>
        </div>
        <div style="margin-top:12px;display:flex;justify-content:flex-end">
          <button class="btn-p" style="height:38px;padding:0 18px;font-size:13px" onclick="sendInvite()">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
            Send invite
          </button>
        </div>
      </div>

      <!-- Team list -->
      <div style="font-size:12px;font-weight:600;color:var(--g600);margin-bottom:10px;display:flex;align-items:center;justify-content:space-between">
        <span>People with access</span>
        <span id="team-list-count" style="font-family:'DM Mono',monospace;color:var(--g400);font-weight:400;font-size:11px"></span>
      </div>
      <div class="team-list" id="team-list">
        <!-- populated by JS -->
      </div>
    </div>

  </div>
</div>

<!-- Toast notification -->
<div class="toast" id="toast">
  <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
  <span id="toast-msg">Invite sent!</span>
</div>


<!-- ══ ACTIVITY LOG PANEL ══ -->
<div class="activity-panel" id="activity-panel">
  <div class="act-head">
    <h3>Edit history</h3>
    <button class="close-btn" onclick="closeActivityPanel()">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
    </button>
  </div>
  <div class="act-body" id="act-body">
    <div class="act-empty">No activity yet.<br>Changes will appear here as you fill in the form.</div>
  </div>
</div>

<!-- ══ EXTEND ACCESS MODAL ══ -->
<div class="mbg" id="extend-modal">
  <div class="modal" style="max-width:400px">
    <div class="mh">
      <h2>Extend access</h2>
      <button class="close-btn" onclick="closeExtendModal()">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <input type="hidden" id="extend-modal-id">
    <div style="background:var(--g50);border:1.5px solid var(--g150);border-radius:var(--r-lg);padding:12px 14px;margin-bottom:16px;display:flex;align-items:center;gap:10px">
      <div class="avatar sm" id="extend-target-init" style="flex-shrink:0">?</div>
      <div>
        <div style="font-size:13px;font-weight:600" id="extend-target-name">—</div>
        <div style="font-size:11.5px;color:var(--g400)" id="extend-target-email">—</div>
      </div>
    </div>
    <div class="field">
      <label class="lbl">New access duration</label>
      <div class="dur-group" style="flex-direction:column;gap:7px">
        <label class="ext-pill rp" data-val="5h" onclick="pickExtPill(this)">5 hours</label>
        <label class="ext-pill rp" data-val="1d" onclick="pickExtPill(this)">1 day</label>
        <label class="ext-pill rp on" data-val="7d" onclick="pickExtPill(this)">7 days</label>
        <label class="ext-pill rp" data-val="1m" onclick="pickExtPill(this)">1 month</label>
        <label class="ext-pill rp" data-val="forever" onclick="pickExtPill(this)">Forever — no expiry</label>
      </div>
    </div>
    <div style="display:flex;gap:8px;margin-top:18px">
      <button class="btn-p" style="flex:1;justify-content:center" onclick="confirmExtend()">Confirm extension</button>
      <button class="btn-s" onclick="closeExtendModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- ══ TEST MODE BANNER ══ -->
<div class="test-mode-banner" id="test-mode-banner">⚡ TEST MODE — Validation disabled. For demo purposes only.</div>

  <span class="test-bar-label">Test Mode</span>
  <span class="test-bar-desc">Validation is bypassed — navigate freely between steps</span>
  <div class="test-toggle-wrap">
    <span class="test-toggle-lbl" onclick="toggleTestMode()">
      <span id="test-toggle-status">OFF</span
